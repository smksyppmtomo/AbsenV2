<!doctype html>
<html lang="id" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Absensi SMK YPPM TOMO</title>
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1e293b" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="Absensi YPPM" />
    <meta name="description" content="Aplikasi Absensi Guru dan Staff SMK YPPM TOMO" />
    <meta name="mobile-web-app-capable" content="yes" />
    <!-- Favicon & Icons -->
    <link rel="icon" type="image/png" href="https://iili.io/KjIKMJ9.png" />
    <link rel="apple-touch-icon" href="https://iili.io/KjIKMJ9.png" />
    <!-- PWA Manifest -->
    <link
      rel="manifest"
      href="data:application/json;base64,ewogICJuYW1lIjogIkFic2Vuc2kgU01LIFlQUE0gVE9NTyIsCiAgInNob3J0X25hbWUiOiAiQWJzZW5zaSBZUFBNIiwKICAiZGVzY3JpcHRpb24iOiAiQXBsaWthc2kgQWJzZW5zaSBHdXJ1IGRhbiBTdGFmZiBTTUsgWVBQTSBUT01PIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiMxZTI5M2IiLAogICJ0aGVtZV9jb2xvciI6ICIjMWUyOTNiIiwKICAib3JpZW50YXRpb24iOiAicG9ydHJhaXQiLAogICJpY29ucyI6IFsKICAgIHsKICAgICAgInNyYyI6ICJodHRwczovL2lpbGkuaW8vS2pJS01KOS5wbmciLAogICAgICAic2l6ZXMiOiAiMTkyeDE5MiIsCiAgICAgICJ0eXBlIjogImltYWdlL3BuZyIsCiAgICAgICJwdXJwb3NlIjogImFueSBtYXNrYWJsZSIKICAgIH0sCiAgICB7CiAgICAgICJzcmMiOiAiaHR0cHM6Ly9paWxpLmlvL0tqSUtNSjkucG5nIiwKICAgICAgInNpemVzIjogIjUxMng1MTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9wbmciLAogICAgICAicHVycG9zZSI6ICJhbnkgbWFza2FibGUiCiAgICB9CiAgXQp9"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/_sdk/element_sdk.js"></script>
    <!-- Leaflet CSS for Map -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <!-- Particles.js for Background Animation -->
    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&amp;display=swap" rel="stylesheet" />
    <style>
      body {
        box-sizing: border-box;
        font-family: "Poppins", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      .page {
        display: none;
      }

      .page.active {
        display: block;
      }

      .gradient-bg {
        background: linear-gradient(135deg, #1e293b 0%, #334155 50%, #475569 100%);
      }

      /* Dark mode styles */
      body.dark-mode {
        background: linear-gradient(to bottom right, #0f172a, #1e293b, #334155);
      }

      body.dark-mode .card-modern {
        background: #1e293b;
        border-color: #334155;
      }

      body.dark-mode .gradient-bg {
        background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%);
      }

      body.dark-mode .text-slate-800 {
        color: #e2e8f0 !important;
      }

      body.dark-mode .text-slate-700 {
        color: #cbd5e1 !important;
      }

      body.dark-mode .text-slate-600 {
        color: #94a3b8 !important;
      }

      body.dark-mode .text-slate-500 {
        color: #64748b !important;
      }

      body.dark-mode .bg-white {
        background-color: #1e293b !important;
      }

      body.dark-mode .border-slate-200 {
        border-color: #334155 !important;
      }

      body.dark-mode .bg-slate-50,
      body.dark-mode .bg-slate-100 {
        background: linear-gradient(135deg, #1e293b 0%, #334155 100%) !important;
      }

      body.dark-mode .from-slate-50,
      body.dark-mode .to-slate-100 {
        --tw-gradient-from: #1e293b !important;
        --tw-gradient-to: #334155 !important;
      }

      body.dark-mode .bg-slate-200,
      body.dark-mode .bg-slate-300 {
        background-color: #334155 !important;
      }

      body.dark-mode input,
      body.dark-mode select,
      body.dark-mode textarea {
        background-color: #0f172a !important;
        color: #e2e8f0 !important;
        border-color: #334155 !important;
      }

      body.dark-mode input::placeholder,
      body.dark-mode select::placeholder,
      body.dark-mode textarea::placeholder {
        color: #64748b !important;
      }

      body.dark-mode .status-option {
        background: rgba(30, 41, 59, 0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border-color: #475569;
      }

      /* Glassmorphism untuk modal di dark mode */
      body.dark-mode #edit-modal > div,
      body.dark-mode #delete-modal > div,
      body.dark-mode #success-modal > div,
      body.dark-mode #submit-confirmation-modal > div,
      body.dark-mode #password-modal > div {
        background: rgba(30, 41, 59, 0.9) !important;
        backdrop-filter: blur(20px) !important;
        -webkit-backdrop-filter: blur(20px) !important;
        border: 1px solid rgba(255, 255, 255, 0.1) !important;
      }

      body.dark-mode #camera-placeholder,
      body.dark-mode #location-loading {
        background: linear-gradient(to bottom right, #1e293b, #334155) !important;
        border-color: #475569 !important;
      }

      body.dark-mode ::-webkit-scrollbar-track {
        background: #1e293b;
      }

      body.dark-mode ::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #64748b, #475569);
      }

      .card-modern {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 24px;
        box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.18);
      }

      body.dark-mode .card-modern {
        background: rgba(30, 41, 59, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .btn-gradient {
        background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
      }

      .status-option {
        background: rgba(248, 250, 252, 0.8);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 3px solid transparent;
        transition: all 0.2s ease;
      }

      .status-option.selected {
        border-color: #1e293b;
        background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
        box-shadow: 0 4px 15px rgba(30, 41, 59, 0.2);
      }

      .status-option.masuk.selected {
        background: linear-gradient(135deg, #64748b 0%, #475569 100%);
      }

      .status-option.pulang.selected {
        background: linear-gradient(135deg, #fcd34d 0%, #fbbf24 100%);
        border-color: #f59e0b;
      }

      .status-option.dinas.selected {
        background: linear-gradient(135deg, #c084fc 0%, #a78bfa 100%);
        border-color: #9333ea;
      }

      .camera-preview {
        transform: scaleX(-1);
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #f1f5f9;
      }

      ::-webkit-scrollbar-thumb {
        background: linear-gradient(to bottom, #475569, #334155);
        border-radius: 4px;
      }

      .map-container {
        z-index: 1;
      }

      .toast {
        animation:
          toastIn 0.4s ease-out,
          toastOut 0.4s ease-in 2.6s forwards;
      }

      @keyframes toastIn {
        from {
          transform: translateY(-100%);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }

      @keyframes toastOut {
        from {
          transform: translateY(0);
          opacity: 1;
        }
        to {
          transform: translateY(-100%);
          opacity: 0;
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-10px);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(10px);
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.8);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes successPulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
      }

      @keyframes checkmark {
        0% {
          stroke-dashoffset: 100;
        }
        100% {
          stroke-dashoffset: 0;
        }
      }

      .progress-step {
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .progress-step.active {
        background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        transform: scale(1.1);
      }

      .progress-step.completed {
        background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
        color: white;
        box-shadow: 0 4px 15px rgba(16, 185, 129, 0.4);
      }

      .slide-down {
        animation: slideDown 0.5s ease-out;
      }

      .scale-in {
        animation: scaleIn 0.4s ease-out;
      }

      .status-option {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .status-option:hover {
        transform: translateY(-4px);
      }

      .status-option.selected {
        animation: scaleIn 0.3s ease-out;
      }

      /* Pull to Refresh */
      .pull-to-refresh-container {
        position: relative;
        overflow: hidden;
      }

      .pull-to-refresh-indicator {
        position: absolute;
        top: -80px;
        left: 50%;
        transform: translateX(-50%);
        width: 60px;
        height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
        background: white;
        border-radius: 50%;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        transition: top 0.3s ease;
        z-index: 100;
      }

      body.dark-mode .pull-to-refresh-indicator {
        background: #1e293b;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      }

      .pull-to-refresh-indicator.pulling {
        top: 20px;
      }

      .pull-to-refresh-indicator.refreshing {
        top: 20px;
      }

      .pull-icon {
        transition: transform 0.3s ease;
      }

      .pull-icon.rotate {
        transform: rotate(180deg);
      }

      /* Empty State */
      .empty-state {
        text-align: center;
        padding: 3rem 1.5rem;
      }

      .empty-state-icon {
        width: 120px;
        height: 120px;
        margin: 0 auto 1.5rem;
        opacity: 0.6;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-10px);
        }
      }

      .empty-state-icon {
        animation: float 3s ease-in-out infinite;
      }

      /* Success Animation */
      .success-checkmark {
        stroke-dasharray: 100;
        stroke-dashoffset: 100;
        animation: checkmark 0.6s ease-out forwards;
      }

      .loading-overlay {
        animation: fadeIn 0.3s ease-out;
      }

      .fade-in {
        animation: fadeIn 0.4s ease-out;
      }

      .time-display {
        background: linear-gradient(135deg, #f97316 0%, #fb923c 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      /* Confetti Animation */
      .confetti {
        position: fixed;
        width: 10px;
        height: 10px;
        top: -10px;
        z-index: 9999;
        pointer-events: none;
      }

      @keyframes confetti-fall {
        0% {
          transform: translateY(0) rotateZ(0deg);
          opacity: 1;
        }
        100% {
          transform: translateY(100vh) rotateZ(720deg);
          opacity: 0;
        }
      }

      .confetti-particle {
        animation: confetti-fall linear forwards;
      }

      .icon-wrapper {
        background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
        position: relative;
      }

      .icon-wrapper::after {
        content: "";
        position: absolute;
        inset: -2px;
        background: linear-gradient(135deg, #f59e0b, #fb923c);
        border-radius: inherit;
        z-index: -1;
        opacity: 0.5;
        filter: blur(8px);
      }

      /* Base mobile-first responsive */
      .app-container {
        width: 100%;
        max-width: 100%;
      }

      /* Extra small devices (phones, 320px and up) */
      @media (min-width: 320px) {
        .card-modern {
          padding: 1rem;
          border-radius: 16px;
        }

        .status-option {
          padding: 0.75rem;
        }

        .status-option .text-center div {
          width: 2.5rem;
          height: 2.5rem;
          margin-bottom: 0.5rem;
        }

        .status-option .text-center svg {
          width: 1.25rem;
          height: 1.25rem;
        }

        .status-option .text-center p {
          font-size: 0.7rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 200px;
        }

        #map {
          height: 180px;
        }

        .icon-wrapper {
          width: 3.5rem;
          height: 3.5rem;
        }

        .icon-wrapper svg {
          width: 1.75rem;
          height: 1.75rem;
        }

        #current-time {
          font-size: 1.75rem;
        }
      }

      /* Small devices (landscape phones, 480px and up) */
      @media (min-width: 480px) {
        .card-modern {
          padding: 1.25rem;
          border-radius: 20px;
        }

        .status-option {
          padding: 1rem;
        }

        .status-option .text-center div {
          width: 3rem;
          height: 3rem;
          margin-bottom: 0.625rem;
        }

        .status-option .text-center svg {
          width: 1.5rem;
          height: 1.5rem;
        }

        .status-option .text-center p {
          font-size: 0.8rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 240px;
        }

        #map {
          height: 200px;
        }

        .icon-wrapper {
          width: 4rem;
          height: 4rem;
        }

        .icon-wrapper svg {
          width: 2rem;
          height: 2rem;
        }

        #current-time {
          font-size: 2rem;
        }
      }

      /* Medium devices (tablets, 640px and up) */
      @media (min-width: 640px) {
        .card-modern {
          padding: 1.5rem;
          border-radius: 24px;
        }

        .status-option {
          padding: 1.25rem;
        }

        .status-option .text-center div {
          width: 3.5rem;
          height: 3.5rem;
          margin-bottom: 0.75rem;
        }

        .status-option .text-center svg {
          width: 1.75rem;
          height: 1.75rem;
        }

        .status-option .text-center p {
          font-size: 0.875rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 280px;
        }

        #map {
          height: 220px;
        }

        .icon-wrapper {
          width: 4.5rem;
          height: 4.5rem;
        }

        .icon-wrapper svg {
          width: 2.25rem;
          height: 2.25rem;
        }

        #current-time {
          font-size: 2.25rem;
        }
      }

      /* Large devices (desktops, 768px and up) */
      @media (min-width: 768px) {
        .card-modern {
          padding: 1.5rem;
        }

        .status-option {
          padding: 1.5rem;
        }

        .status-option .text-center div {
          width: 3.5rem;
          height: 3.5rem;
        }

        .status-option .text-center svg {
          width: 1.75rem;
          height: 1.75rem;
        }

        .status-option .text-center p {
          font-size: 0.875rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 320px;
        }

        #map {
          height: 240px;
        }

        #current-time {
          font-size: 2.5rem;
        }
      }

      /* Extra large devices (large desktops, 1024px and up) */
      @media (min-width: 1024px) {
        .app-container {
          max-width: 600px;
          margin: 0 auto;
        }

        .card-modern {
          padding: 2rem;
        }

        .status-option {
          padding: 1.75rem;
        }

        .status-option .text-center div {
          width: 4rem;
          height: 4rem;
        }

        .status-option .text-center svg {
          width: 2rem;
          height: 2rem;
        }

        .status-option .text-center p {
          font-size: 1rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 360px;
        }

        #map {
          height: 280px;
        }

        .icon-wrapper {
          width: 5rem;
          height: 5rem;
        }

        .icon-wrapper svg {
          width: 2.5rem;
          height: 2.5rem;
        }

        #current-time {
          font-size: 2.5rem;
        }
      }

      /* 2XL devices (larger desktops, 1280px and up) */
      @media (min-width: 1280px) {
        .app-container {
          max-width: 640px;
        }

        .card-modern {
          padding: 2.25rem;
        }

        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 400px;
        }

        #map {
          height: 300px;
        }
      }

      /* Ultra wide screens */
      @media (min-width: 1536px) {
        .app-container {
          max-width: 680px;
        }
      }

      /* Landscape orientation adjustments */
      @media (orientation: landscape) and (max-height: 500px) {
        .camera-preview,
        #captured-photo,
        #camera-placeholder {
          height: 220px;
        }

        #map {
          height: 180px;
        }

        .card-modern {
          padding: 1rem;
        }

        .status-option {
          padding: 0.75rem;
        }
      }

      /* Text scaling for smaller devices */
      @media (max-width: 360px) {
        html {
          font-size: 14px;
        }

        .card-modern h2,
        .card-modern h3 {
          font-size: 1.25rem;
        }

        .card-modern .text-lg {
          font-size: 1rem;
        }

        #current-time {
          font-size: 1.5rem;
        }

        .status-option .text-center div {
          width: 2.25rem;
          height: 2.25rem;
        }

        .status-option .text-center svg {
          width: 1.125rem;
          height: 1.125rem;
        }

        .status-option .text-center p {
          font-size: 0.65rem;
        }
      }

      /* Touch target improvements for mobile */
      @media (hover: none) and (pointer: coarse) {
        button,
        select,
        input,
        a {
          min-height: 44px;
          min-width: 44px;
        }

        .status-option {
          min-height: 100px;
        }
      }

      /* Particle Background */
      #particles-js {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: 0;
        pointer-events: none;
      }

      /* Ensure content is above particles */
      #app {
        position: relative;
        z-index: 1;
      }

      /* Parallax Scrolling */
      .parallax-container {
        position: relative;
        overflow: hidden;
      }

      .parallax-layer {
        position: absolute;
        width: 100%;
        height: 100%;
        transition: transform 0.1s ease-out;
      }

      .parallax-bg {
        transform: translateY(0);
      }

      /* Quote of the Day */
      .quote-card {
        background: linear-gradient(135deg, rgba(249, 115, 22, 0.1) 0%, rgba(251, 146, 60, 0.1) 100%);
        border-left: 4px solid #f97316;
        animation: slideInFromLeft 0.8s ease-out;
      }

      @keyframes slideInFromLeft {
        from {
          opacity: 0;
          transform: translateX(-30px);
        }
        to {
          opacity: 1;
          transform: translateX(0);
        }
      }

      .quote-icon {
        opacity: 0.15;
        font-size: 4rem;
        line-height: 1;
        font-family: Georgia, serif;
      }
    </style>
    <style>
      @view-transition {
        navigation: auto;
      }
    </style>
    <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  </head>
  <body class="h-full bg-gradient-to-br from-slate-100 via-slate-50 to-slate-200">
    <!-- Particle Background -->
    <div id="particles-js"></div>
    <!-- Initial Loading Screen -->
    <div id="initial-loading" class="fixed inset-0 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 z-[200] flex items-center justify-center">
      <div class="text-center">
        <div class="relative mb-8 mx-auto w-24 h-24">
          <div class="w-24 h-24 border-4 border-orange-500/30 rounded-full"></div>
          <div class="w-24 h-24 border-4 border-orange-500 border-t-transparent rounded-full animate-spin absolute top-0 left-0"></div>
        </div>
        <h1 class="text-white text-3xl font-black mb-2">Absensi SMK YPPM TOMO</h1>
        <p class="text-slate-300 text-lg font-medium">Memuat aplikasi...</p>
      </div>
    </div>
    <div id="app" class="h-full overflow-auto pull-to-refresh-container">
      <!-- Pull to Refresh Indicator -->
      <div id="pull-to-refresh-indicator" class="pull-to-refresh-indicator">
        <svg id="pull-icon" class="w-8 h-8 text-orange-500 pull-icon" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
        <svg id="pull-spinner" class="w-8 h-8 text-orange-500 hidden" style="animation: spin 1s linear infinite" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" />
          <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
        </svg>
      </div>
      <!-- Loading Overlay -->
      <div id="loading-overlay" class="fixed inset-0 bg-gradient-to-br from-slate-900/95 via-slate-800/95 to-slate-900/95 backdrop-blur-md z-[100] hidden loading-overlay">
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-center">
          <div class="relative mb-6 mx-auto w-20 h-20">
            <div class="w-20 h-20 border-4 border-orange-500/30 rounded-full"></div>
            <div class="w-20 h-20 border-4 border-orange-500 border-t-transparent rounded-full animate-spin absolute top-0 left-0"></div>
          </div>
          <p class="text-white text-lg font-bold mb-2">Memuat Data...</p>
          <p class="text-slate-300 text-sm font-medium">Mohon tunggu sebentar</p>
        </div>
      </div>
      <!-- Toast Container -->
      <div id="toast-container" class="fixed top-4 left-1/2 transform -translate-x-1/2 z-50"></div>
      <!-- Header -->
      <header class="gradient-bg text-white shadow-2xl sticky top-0 z-30 backdrop-blur-lg bg-slate-800/90 parallax-container">
        <div class="parallax-layer parallax-bg"></div>
        <div class="max-w-lg mx-auto px-5 py-5 relative z-10">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-4">
              <div class="relative">
                <img
                  src="https://iili.io/KjIKMJ9.png"
                  alt="Logo SMK YPPM TOMO"
                  class="w-14 h-14 rounded-2xl shadow-2xl bg-white p-1.5"
                  loading="lazy"
                  onerror="
                    this.style.background = '#ffffff';
                    this.alt = 'Logo';
                  "
                />
                <div class="absolute -inset-1 bg-white/30 rounded-2xl blur-md"></div>
              </div>
              <div>
                <h1 id="header-title" class="font-bold text-xl tracking-tight">Absensi</h1>
                <p id="header-school" class="text-sm text-slate-100 font-medium">SMK YPPM TOMO</p>
              </div>
            </div>
            <div class="flex items-center gap-2">
              <button id="header-install-btn" onclick="installPWA()" class="bg-white/20 hover:bg-white/30 p-2.5 rounded-xl transition backdrop-blur-sm flex items-center justify-center" title="Install Aplikasi">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>
              </button>
              <button id="dark-mode-toggle" onclick="toggleDarkMode()" class="bg-white/20 hover:bg-white/30 p-2.5 rounded-xl transition backdrop-blur-sm flex items-center justify-center" title="Toggle Dark Mode">
                <svg id="dark-mode-icon-sun" class="w-5 h-5 hidden" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"
                  />
                </svg>
                <svg id="dark-mode-icon-moon" class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
                </svg>
              </button>
              <button onclick="promptAdminPassword()" class="bg-white/20 hover:bg-white/30 p-2.5 rounded-xl transition backdrop-blur-sm flex items-center justify-center" title="Admin Panel">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                  />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </button>
            </div>
          </div>
        </div>
      </header>
      <!-- Main Attendance Page -->
      <div id="page-attendance" class="page active">
        <div class="max-w-lg mx-auto px-5 py-8 space-y-8">
          <!-- Progress Indicator -->
          <div class="card-modern p-6 sticky top-20 z-20 backdrop-blur-xl bg-white/80">
            <div class="flex items-center justify-between mb-3">
              <div class="flex-1">
                <div class="flex items-center gap-2">
                  <div
                    id="progress-step-1"
                    class="progress-step active w-10 h-10 rounded-full bg-gradient-to-r from-orange-500 to-orange-600 text-white flex items-center justify-center font-bold text-sm shadow-lg transition-all duration-300"
                  >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                    </svg>
                  </div>
                  <div class="flex-1 h-1 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar-1" class="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-500 w-0"></div>
                  </div>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2">
                  <div id="progress-step-2" class="progress-step w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-bold text-sm shadow-sm transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                    </svg>
                  </div>
                  <div class="flex-1 h-1 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar-2" class="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-500 w-0"></div>
                  </div>
                </div>
              </div>
              <div class="flex-1">
                <div class="flex items-center gap-2">
                  <div id="progress-step-3" class="progress-step w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-bold text-sm shadow-sm transition-all duration-300">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2.5"
                        d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                      />
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                    </svg>
                  </div>
                  <div class="flex-1 h-1 bg-slate-200 rounded-full overflow-hidden">
                    <div id="progress-bar-3" class="h-full bg-gradient-to-r from-orange-500 to-orange-600 transition-all duration-500 w-0"></div>
                  </div>
                </div>
              </div>
              <div>
                <div id="progress-step-4" class="progress-step w-10 h-10 rounded-full bg-slate-200 text-slate-400 flex items-center justify-center font-bold text-sm shadow-sm transition-all duration-300">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
              </div>
            </div>
            <div class="flex justify-between text-xs font-semibold text-slate-600 px-1">
              <span class="w-10 text-center">Nama</span> <span class="w-10 text-center">Status</span> <span class="w-10 text-center">Foto</span> <span class="w-10 text-center">Siap</span>
            </div>
          </div>
          <!-- Quote of the Day -->
          <div class="quote-card card-modern p-6 relative overflow-hidden">
            <div class="quote-icon absolute top-2 left-4 text-orange-500">"</div>
            <div class="relative z-10">
              <div class="flex items-start gap-3 mb-3">
                <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-lg">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-orange-600 font-semibold uppercase tracking-wide mb-1">üí≠ Quote of the Day</p>
                  <p id="quote-text" class="text-slate-700 font-semibold text-base leading-relaxed italic mb-2"></p>
                  <p id="quote-author" class="text-slate-500 text-sm font-medium"></p>
                </div>
              </div>
            </div>
          </div>
          <!-- Date Time Card -->
          <div class="card-modern p-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-slate-300/30 to-slate-200/30 rounded-full blur-3xl"></div>
            <div class="relative flex items-center justify-between">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-2 h-2 bg-slate-600 rounded-full"></div>
                  <p class="text-slate-600 text-sm font-medium uppercase tracking-wide">Waktu Saat Ini</p>
                </div>
                <p id="current-date" class="text-slate-700 font-semibold mb-1"></p>
                <p id="current-time" class="text-4xl font-black time-display"></p>
              </div>
              <div class="icon-wrapper w-20 h-20 rounded-full flex items-center justify-center shadow-lg">
                <svg id="analog-clock" class="w-20 h-20" viewbox="0 0 100 100">
                  <!-- Clock face -->
                  <circle cx="50" cy="50" r="45" fill="white" stroke="#f97316" stroke-width="3" />
                  <!-- Hour markers -->
                  <line x1="50" y1="10" x2="50" y2="15" stroke="#f97316" stroke-width="2" />
                  <line x1="50" y1="85" x2="50" y2="90" stroke="#f97316" stroke-width="2" />
                  <line x1="10" y1="50" x2="15" y2="50" stroke="#f97316" stroke-width="2" />
                  <line x1="85" y1="50" x2="90" y2="50" stroke="#f97316" stroke-width="2" />
                  <!-- Hour hand -->
                  <line id="hour-hand" x1="50" y1="50" x2="50" y2="30" stroke="#334155" stroke-width="3" stroke-linecap="round" />
                  <!-- Minute hand -->
                  <line id="minute-hand" x1="50" y1="50" x2="50" y2="20" stroke="#64748b" stroke-width="2.5" stroke-linecap="round" />
                  <!-- Second hand -->
                  <line id="second-hand" x1="50" y1="50" x2="50" y2="15" stroke="#f97316" stroke-width="1.5" stroke-linecap="round" />
                  <!-- Center dot -->
                  <circle cx="50" cy="50" r="3" fill="#f97316" />
                </svg>
              </div>
            </div>
          </div>
          <!-- Name Selection -->
          <div class="card-modern p-6">
            <label class="block mb-4">
              <div class="flex items-center gap-3 mb-3">
                <div class="w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl flex items-center justify-center shadow-lg">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <span class="text-lg font-bold text-slate-800">Pilih Nama Anda</span>
              </div></label
            >
            <select
              id="staff-select"
              onchange="checkDuplicateAttendance()"
              class="w-full p-4 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition text-slate-700 font-semibold bg-white text-base shadow-sm"
            >
              <option value="">-- Pilih Nama Guru/Staff --</option>
            </select>
            <!-- Duplicate Attendance Warning -->
            <div id="duplicate-warning" class="hidden mt-4 bg-gradient-to-r from-amber-50 to-orange-50 border-2 border-amber-300 rounded-2xl p-4 animate-pulse">
              <div class="flex items-start gap-3">
                <div class="w-10 h-10 bg-amber-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                  <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="font-bold text-amber-800 mb-1">ÔøΩÔøΩÔøΩÔøΩÔ∏è Perhatian: Sudah Ada Absensi Hari Ini</p>
                  <p id="duplicate-details" class="text-sm text-amber-700 leading-relaxed font-medium"></p>
                </div>
              </div>
            </div>
          </div>
          <!-- Status Selection -->
          <div class="card-modern p-6">
            <div class="flex items-center gap-3 mb-5">
              <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                </svg>
              </div>
              <span class="text-lg font-bold text-slate-800">Status Kehadiran</span>
            </div>
            <div class="grid grid-cols-3 gap-4">
              <button onclick="selectStatus('masuk')" class="status-option masuk p-5 rounded-2xl hover:shadow-xl" data-status="masuk">
                <div class="text-center">
                  <div class="w-14 h-14 bg-slate-600 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1" />
                    </svg>
                  </div>
                  <p class="font-bold text-slate-800 text-sm">Masuk</p>
                </div>
              </button>
              <button onclick="selectStatus('pulang')" class="status-option pulang p-5 rounded-2xl hover:shadow-xl" data-status="pulang">
                <div class="text-center">
                  <div class="w-14 h-14 bg-amber-500 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
                    </svg>
                  </div>
                  <p class="font-bold text-slate-800 text-sm">Pulang</p>
                </div>
              </button>
              <button onclick="selectStatus('dinas')" class="status-option dinas p-5 rounded-2xl hover:shadow-xl" data-status="dinas">
                <div class="text-center">
                  <div class="w-14 h-14 bg-purple-500 rounded-2xl flex items-center justify-center mx-auto mb-3 shadow-lg">
                    <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>
                  </div>
                  <p class="font-bold text-slate-800 text-sm">Dinas</p>
                </div>
              </button>
            </div>
          </div>
          <!-- Camera Section -->
          <div class="card-modern p-6">
            <div class="flex items-center gap-3 mb-5">
              <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2.5"
                    d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                  />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <span class="text-lg font-bold text-slate-800">Foto Selfie</span>
            </div>
            <div id="camera-container" class="relative">
              <div id="camera-placeholder" class="w-full h-72 bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl flex flex-col items-center justify-center p-6 border-3 border-dashed border-purple-200">
                <div class="w-16 h-16 bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl flex items-center justify-center mb-4 shadow-lg">
                  <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                    />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z" />
                  </svg>
                </div>
                <p class="text-slate-700 font-bold mb-4 text-center">Klik tombol di bawah untuk membuka kamera</p>
              </div>
              <button
                id="open-camera-btn"
                onclick="startCamera()"
                class="w-full mt-5 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-4 rounded-2xl font-bold transition shadow-lg flex items-center justify-center gap-2"
              >
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
                </svg>
                Buka Kamera
              </button>
              <video id="camera-video" class="w-full h-72 object-cover rounded-2xl hidden camera-preview shadow-lg"></video>
              <canvas id="camera-canvas" class="hidden"></canvas><img id="captured-photo" class="w-full h-72 object-cover rounded-2xl hidden shadow-lg" />
              <div id="camera-controls" class="hidden mt-5 flex gap-4">
                <button
                  onclick="capturePhoto()"
                  class="flex-1 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white py-4 rounded-2xl font-bold transition flex items-center justify-center gap-2 shadow-lg"
                >
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"
                    />
                  </svg>
                  Ambil Foto
                </button>
                <button onclick="stopCamera()" class="bg-slate-500 hover:bg-slate-600 text-white px-5 py-4 rounded-2xl font-bold transition shadow-lg">‚úï</button>
              </div>
              <div id="photo-controls" class="hidden mt-5">
                <button onclick="retakePhoto()" class="w-full bg-slate-500 hover:bg-slate-600 text-white py-4 rounded-2xl font-bold transition flex items-center justify-center gap-3 shadow-lg">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                  </svg>
                  Ambil Ulang Foto
                </button>
              </div>
            </div>
          </div>
          <!-- Location Section -->
          <div class="card-modern p-6">
            <div class="flex items-center gap-3 mb-5">
              <div class="w-10 h-10 bg-gradient-to-br from-red-500 to-rose-600 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <span class="text-lg font-bold text-slate-800">Lokasi Kehadiran</span>
            </div>
            <div id="location-container">
              <div id="location-loading" class="w-full h-56 bg-gradient-to-br from-red-50 to-orange-50 rounded-2xl flex flex-col items-center justify-center border-3 border-dashed border-red-200">
                <div class="w-14 h-14 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"></div>
                <p class="text-slate-700 font-semibold">Mendapatkan lokasi otomatis...</p>
              </div>
              <div id="location-result" class="hidden">
                <div id="map" class="w-full h-56 rounded-2xl mb-4 map-container shadow-lg"></div>
                <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-5 border-2 border-slate-200">
                  <div class="flex items-start gap-3">
                    <div class="w-10 h-10 bg-red-500 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                      <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                      </svg>
                    </div>
                    <div class="flex-1">
                      <p class="text-xs text-slate-500 font-semibold uppercase tracking-wide mb-1">Alamat:</p>
                      <p id="location-address" class="text-slate-700 font-semibold text-sm leading-relaxed"></p>
                      <p class="text-xs text-slate-400 mt-2 font-medium" id="location-coords"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Submit Button -->
          <button
            id="submit-btn"
            onclick="submitAttendance()"
            disabled
            class="w-full btn-gradient text-white py-5 rounded-2xl font-black text-lg shadow-2xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3"
          >
            <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg> Kirim Absensi Sekarang
          </button>
        </div>
      </div>
      <!-- Admin Page -->
      <div id="page-admin" class="page">
        <div class="max-w-lg mx-auto px-5 py-8 space-y-8">
          <!-- Back Button -->
          <button onclick="showPage('attendance')" class="flex items-center gap-3 text-slate-600 hover:text-slate-800 transition font-semibold">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg><span>Kembali ke Absensi</span>
          </button>
          <!-- Admin Header -->
          <div class="card-modern p-6 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-40 h-40 bg-gradient-to-br from-slate-300/30 to-slate-200/30 rounded-full blur-3xl"></div>
            <div class="relative flex items-center gap-4">
              <div class="w-16 h-16 bg-gradient-to-br from-slate-600 to-slate-700 rounded-2xl flex items-center justify-center shadow-xl">
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2.5"
                    d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
                  />
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                </svg>
              </div>
              <div>
                <h2 class="text-2xl font-black text-slate-800">Dashboard Admin</h2>
                <p class="text-slate-600 font-medium">Kelola data guru dan staff</p>
              </div>
            </div>
          </div>
          <!-- Add Staff Form -->
          <div class="card-modern p-6">
            <div class="flex items-center gap-3 mb-5">
              <div class="w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl flex items-center justify-center shadow-lg">
                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
                </svg>
              </div>
              <span class="text-lg font-bold text-slate-800">Tambah Guru/Staff</span>
            </div>
            <form id="add-staff-form" onsubmit="addStaff(event)" class="space-y-4">
              <div>
                <label for="new-staff-name" class="block text-sm font-bold text-slate-700 mb-2">Nama Lengkap</label>
                <input
                  type="text"
                  id="new-staff-name"
                  placeholder="Masukkan nama guru/staff"
                  required
                  class="w-full p-4 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition font-semibold shadow-sm"
                />
              </div>
              <button type="submit" id="add-staff-btn" class="w-full btn-gradient text-white py-4 rounded-2xl font-bold flex items-center justify-center gap-3 shadow-lg">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6" /></svg> Tambah Guru/Staff
              </button>
            </form>
          </div>
          <!-- Staff List -->
          <div class="card-modern p-6">
            <div class="flex items-center justify-between mb-5">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center shadow-lg">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"
                    />
                  </svg>
                </div>
                <span class="text-lg font-bold text-slate-800">Daftar Guru/Staff</span>
              </div>
              <span id="staff-count" class="bg-gradient-to-r from-orange-500 to-orange-600 text-white px-4 py-2 rounded-xl text-sm font-black shadow-lg">0</span>
            </div>
            <div id="staff-list" class="space-y-3"><!-- Empty state will be inserted here --></div>
          </div>
          <!-- Attendance Records -->
          <div class="card-modern p-6">
            <div class="flex items-center justify-between mb-5">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center shadow-lg">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                    />
                  </svg>
                </div>
                <span class="text-lg font-bold text-slate-800">Rekap Absensi</span>
              </div>
              <span id="attendance-count" class="bg-gradient-to-r from-purple-500 to-purple-600 text-white px-4 py-2 rounded-xl text-sm font-black shadow-lg">0</span>
            </div>
            <!-- Filter -->
            <div class="mb-5 space-y-3">
              <div class="grid grid-cols-1 gap-3">
                <select id="filter-name" onchange="filterAttendance()" class="w-full p-4 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition font-semibold shadow-sm bg-white">
                  <option value="">ÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩÔøΩ Semua Guru/Staff</option>
                </select>
                <div class="flex gap-3">
                  <input type="date" id="filter-date" onchange="filterAttendance()" class="flex-1 p-4 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition font-semibold shadow-sm" />
                  <button onclick="clearFilter()" class="bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white px-6 py-4 rounded-2xl font-bold transition shadow-lg whitespace-nowrap">
                    Reset
                  </button>
                </div>
              </div>
              <p id="filter-info" class="text-sm text-slate-600 font-medium text-center"></p>
            </div>
            <div id="attendance-records" class="space-y-3 max-h-96 overflow-y-auto"><!-- Empty state will be inserted here --></div>
          </div>
        </div>
      </div>
    </div>
    <!-- Edit Staff Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
      <div class="bg-white/90 backdrop-filter backdrop-blur-xl rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-white/20">
        <div>
          <div class="w-20 h-20 bg-gradient-to-br from-slate-600 to-slate-700 rounded-3xl flex items-center justify-center mx-auto mb-5 shadow-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
            </svg>
          </div>
          <h3 class="text-2xl font-black text-slate-800 mb-5 text-center">Edit Nama Guru/Staff</h3>
          <form onsubmit="saveEditStaff(event)">
            <div class="mb-6">
              <label for="edit-staff-name" class="block text-sm font-bold text-slate-700 mb-2">Nama Lengkap</label>
              <input type="text" id="edit-staff-name" required class="w-full p-4 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition font-semibold shadow-sm" />
            </div>
            <div class="flex gap-4">
              <button type="button" onclick="closeEditModal()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-4 rounded-2xl font-bold transition shadow-md">Batal</button>
              <button type="submit" id="save-edit-btn" class="flex-1 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white py-4 rounded-2xl font-bold transition shadow-lg">Simpan</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
      <div class="bg-white/90 backdrop-filter backdrop-blur-xl rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-white/20">
        <div class="text-center">
          <div class="w-20 h-20 bg-gradient-to-br from-red-500 to-rose-600 rounded-3xl flex items-center justify-center mx-auto mb-5 shadow-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
            </svg>
          </div>
          <h3 class="text-2xl font-black text-slate-800 mb-3">Hapus Data?</h3>
          <p id="delete-modal-text" class="text-slate-600 mb-7 font-medium leading-relaxed">Apakah Anda yakin ingin menghapus data ini?</p>
          <div class="flex gap-4">
            <button onclick="closeDeleteModal()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-4 rounded-2xl font-bold transition shadow-md">Batal</button>
            <button id="confirm-delete-btn" onclick="confirmDelete()" class="flex-1 bg-gradient-to-r from-red-500 to-rose-600 hover:from-red-600 hover:to-rose-700 text-white py-4 rounded-2xl font-bold transition shadow-lg">Hapus</button>
          </div>
        </div>
      </div>
    </div>
    <!-- Success Modal -->
    <div id="success-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-[60] hidden flex items-center justify-center p-4">
      <div class="bg-white/90 backdrop-filter backdrop-blur-xl rounded-3xl p-8 max-w-sm w-full shadow-2xl text-center scale-in border border-white/20">
        <div class="relative w-32 h-32 mx-auto mb-6">
          <div class="absolute inset-0 bg-gradient-to-br from-green-400 to-emerald-600 rounded-full animate-pulse opacity-30"></div>
          <div class="relative w-32 h-32 bg-gradient-to-br from-green-500 via-emerald-600 to-green-700 rounded-full flex items-center justify-center shadow-2xl" style="animation: successPulse 1s ease-out">
            <svg class="w-24 h-24" viewbox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
              <circle cx="50" cy="50" r="45" stroke="white" stroke-width="4" fill="none" opacity="0.3" />
              <path class="success-checkmark" d="M25 52 L42 69 L75 31" stroke="white" stroke-width="8" stroke-linecap="round" stroke-linejoin="round" fill="none" />
            </svg>
          </div>
        </div>
        <div class="flex items-center justify-center gap-3 mb-3">
          <h3 class="text-3xl font-black text-slate-800">Berhasil!</h3>
          <svg class="w-10 h-10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="12" cy="12" r="10" fill="#10b981" stroke="#059669" stroke-width="2" />
            <path d="M8 12.5 L10.5 15 L16 9.5" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </div>
        <p class="text-slate-600 font-semibold mb-2">Absensi Anda telah tersimpan</p>
        <p id="success-details" class="text-sm text-slate-500 leading-relaxed mb-6"></p>
        <button onclick="closeSuccessModal()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white py-4 rounded-2xl font-bold transition shadow-lg">
          Kembali ke Halaman Utama
        </button>
      </div>
    </div>
    <!-- Submit Confirmation Modal -->
    <div id="submit-confirmation-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
      <div class="bg-white/90 backdrop-filter backdrop-blur-xl rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-white/20">
        <div class="text-center">
          <div class="relative w-24 h-24 mx-auto mb-5">
            <div class="absolute inset-0 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full animate-pulse opacity-50"></div>
            <div class="relative w-24 h-24 bg-gradient-to-br from-orange-500 via-orange-600 to-orange-700 rounded-full flex items-center justify-center shadow-2xl">
              <div class="absolute inset-0 bg-gradient-to-t from-orange-800/30 to-transparent rounded-full"></div>
              <svg class="w-14 h-14 text-white relative z-10" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <h3 class="text-2xl font-black text-slate-800 mb-3">Konfirmasi Absensi</h3>
          <div class="bg-gradient-to-br from-slate-50 to-slate-100 rounded-2xl p-5 mb-6 border-2 border-slate-200">
            <div class="space-y-3 text-left">
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-slate-600 to-slate-700 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-slate-500 font-semibold">Nama:</p>
                  <p id="confirm-name" class="text-slate-800 font-bold"></p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-orange-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.5"
                      d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"
                    />
                  </svg>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-slate-500 font-semibold">Status:</p>
                  <p id="confirm-status" class="text-slate-800 font-bold"></p>
                </div>
              </div>
              <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl flex items-center justify-center flex-shrink-0 shadow-md">
                  <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                </div>
                <div class="flex-1">
                  <p class="text-xs text-slate-500 font-semibold">Waktu:</p>
                  <p id="confirm-time" class="text-slate-800 font-bold"></p>
                </div>
              </div>
            </div>
          </div>
          <p class="text-slate-600 mb-7 font-medium leading-relaxed">Pastikan data sudah benar sebelum mengirim absensi</p>
          <div class="flex gap-4">
            <button onclick="closeSubmitConfirmation()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-4 rounded-2xl font-bold transition shadow-md">Batal</button>
            <button
              id="confirm-submit-btn"
              onclick="confirmSubmitAttendance()"
              class="flex-1 bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white py-4 rounded-2xl font-bold transition shadow-lg"
            >
              Kirim
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- Password Modal -->
    <div id="password-modal" class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 hidden flex items-center justify-center p-4">
      <div class="bg-white/90 backdrop-filter backdrop-blur-xl rounded-3xl p-8 max-w-sm w-full shadow-2xl border border-white/20">
        <div>
          <div class="w-20 h-20 bg-gradient-to-br from-slate-600 to-slate-700 rounded-3xl flex items-center justify-center mx-auto mb-5 shadow-xl">
            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewbox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
            </svg>
          </div>
          <h3 class="text-2xl font-black text-slate-800 mb-3 text-center">Password Admin</h3>
          <p class="text-slate-600 mb-6 font-medium text-center">Masukkan password untuk akses admin</p>
          <form onsubmit="checkAdminPassword(event)">
            <div class="mb-6">
              <div class="relative">
                <input
                  type="password"
                  id="admin-password-input"
                  placeholder="Masukkan password"
                  required
                  class="w-full p-4 pr-12 border-3 border-slate-200 rounded-2xl focus:border-slate-500 focus:ring-4 focus:ring-slate-100 transition font-semibold shadow-sm text-center"
                  autofocus
                />
                <button type="button" onclick="togglePasswordVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 p-2 text-slate-500 hover:text-slate-700 transition" title="Show/Hide Password">
                  <svg id="password-eye-open" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                  </svg>
                  <svg id="password-eye-closed" class="w-6 h-6" fill="none" stroke="currentColor" viewbox="0 0 24 24">
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"
                    />
                  </svg>
                </button>
              </div>
              <p id="password-error" class="text-red-500 text-sm font-semibold mt-2 hidden">Password salah!</p>
            </div>
            <div class="flex gap-4">
              <button type="button" onclick="closePasswordModal()" class="flex-1 bg-slate-200 hover:bg-slate-300 text-slate-700 py-4 rounded-2xl font-bold transition shadow-md">Batal</button>
              <button type="submit" id="check-password-btn" class="flex-1 bg-gradient-to-r from-slate-600 to-slate-700 hover:from-slate-700 hover:to-slate-800 text-white py-4 rounded-2xl font-bold transition shadow-lg">Masuk</button>
            </div>
          </form>
        </div>
      </div>
    </div>
    <script>
      // App State
      let staffList = [];
      let attendanceList = [];
      let selectedStatus = null;
      let capturedPhotoData = null;
      let currentLocation = null;
      let map = null;
      let cameraStream = null;
      let deleteTarget = null;
      let deferredPrompt = null;
      let isSubmitting = false;
      let isAddingStaff = false;
      let isLoading = false;

      // Quote of the Day Data - 100+ Quotes!
      const quotes = [
        { text: "Pendidikan adalah senjata paling ampuh yang bisa kamu gunakan untuk mengubah dunia.", author: "Nelson Mandela" },
        { text: "Guru yang baik seperti lilin, ia membakar dirinya sendiri untuk menerangi jalan bagi orang lain.", author: "Mustafa Kemal Atat√ºrk" },
        { text: "Kesuksesan adalah jumlah dari usaha-usaha kecil yang diulang hari demi hari.", author: "Robert Collier" },
        { text: "Pendidikan bukan persiapan untuk hidup, pendidikan adalah kehidupan itu sendiri.", author: "John Dewey" },
        { text: "Tidak ada rahasia untuk sukses. Sukses itu hasil dari persiapan, kerja keras, dan belajar dari kegagalan.", author: "Colin Powell" },
        { text: "Masa depan milik mereka yang percaya pada keindahan mimpi-mimpi mereka.", author: "Eleanor Roosevelt" },
        { text: "Satu-satunya cara untuk melakukan pekerjaan besar adalah mencintai apa yang kamu kerjakan.", author: "Steve Jobs" },
        { text: "Kualitas bukan sebuah tindakan, tetapi sebuah kebiasaan.", author: "Aristoteles" },
        { text: "Berani bermimpi, berani berusaha, maka kamu akan sampai pada tujuan.", author: "Bob Sadino" },
        { text: "Pendidikan adalah tiket emas menuju masa depan. Hari esok milik orang-orang yang mempersiapkan dirinya sejak hari ini.", author: "Malcolm X" },
        { text: "Guru sejati mengajarkan muridnya cara berpikir, bukan apa yang harus dipikirkan.", author: "Sidney J. Harris" },
        { text: "Kedisiplinan adalah jembatan antara tujuan dan pencapaian.", author: "Jim Rohn" },
        { text: "Kehadiran adalah bentuk apresiasi tertinggi terhadap tanggung jawab.", author: "Anonim" },
        { text: "Mulailah dengan melakukan apa yang diperlukan, lalu lakukan apa yang mungkin, dan tiba-tiba kamu akan melakukan yang mustahil.", author: "Francis of Assisi" },
        { text: "Kesempatan tidak datang dua kali. Manfaatkan setiap momen untuk menjadi lebih baik.", author: "Anonim" },
        { text: "Investasi dalam pengetahuan memberikan keuntungan terbaik.", author: "Benjamin Franklin" },
        { text: "Pembelajaran adalah harta yang akan mengikuti pemiliknya ke mana pun ia pergi.", author: "Pepatah Tiongkok" },
        { text: "Tujuan pendidikan adalah untuk mengganti pikiran yang kosong dengan pikiran yang terbuka.", author: "Malcolm Forbes" },
        { text: "Orang yang berhenti belajar akan menjadi pemilik masa lalu. Orang yang masih terus belajar, akan menjadi pemilik masa depan.", author: "Mario Teguh" },
        { text: "Kegagalan adalah kesuksesan yang tertunda.", author: "Anonim" },
        { text: "Belajar tanpa berpikir itu tidaklah berguna, tapi berpikir tanpa belajar itu sangatlah berbahaya.", author: "Soekarno" },
        { text: "Jangan pernah berhenti belajar karena hidup tak pernah berhenti mengajarkan.", author: "Anonim" },
        { text: "Guru membuka pintu, tetapi Anda harus memasukinya sendiri.", author: "Pepatah Tiongkok" },
        { text: "Seorang guru berpengaruh pada keabadian; ia tidak pernah tahu di mana pengaruhnya berhenti.", author: "Henry Adams" },
        { text: "Yang terpenting dalam hidup bukanlah kemenangan namun bagaimana bertanding dengan baik.", author: "Baron de Coubertin" },
        { text: "Kesuksesan biasanya datang kepada mereka yang terlalu sibuk mencarinya.", author: "Henry David Thoreau" },
        { text: "Jangan takut gagal. Takutlah untuk tidak mencoba.", author: "Anonim" },
        { text: "Perubahan adalah hasil akhir dari semua pembelajaran sejati.", author: "Leo Buscaglia" },
        { text: "Seseorang yang bertanya bodoh selama 5 menit, tetapi seseorang yang tidak pernah bertanya tetap bodoh selamanya.", author: "Pepatah Tiongkok" },
        { text: "Bukan yang terkuat yang bertahan, bukan juga yang tercerdas, tetapi yang paling mudah beradaptasi dengan perubahan.", author: "Charles Darwin" },
        { text: "Motivasi adalah apa yang membuatmu memulai. Kebiasaan adalah apa yang membuatmu tetap berjalan.", author: "Jim Ryun" },
        { text: "Orang sukses adalah orang yang dapat membangun fondasi yang kuat dengan batu-batu yang dilemparkan kepadanya.", author: "David Brinkley" },
        { text: "Cara terbaik untuk memprediksi masa depan adalah menciptakannya.", author: "Peter Drucker" },
        { text: "Kesempurnaan bukanlah tujuan yang dapat dicapai, tetapi perjalanan yang harus dilalui.", author: "Anonim" },
        { text: "Jadilah perubahan yang ingin kamu lihat di dunia.", author: "Mahatma Gandhi" },
        { text: "Waktu adalah guru terbaik, sayangnya ia membunuh semua muridnya.", author: "Hector Berlioz" },
        { text: "Hiduplah seakan kamu akan mati besok. Belajarlah seakan kamu akan hidup selamanya.", author: "Mahatma Gandhi" },
        { text: "Tidak ada yang mustahil bagi mereka yang mau mencoba.", author: "Alexander the Great" },
        { text: "Bakat memenangkan permainan, tapi kerja tim dan kecerdasan memenangkan kejuaraan.", author: "Michael Jordan" },
        { text: "Jangan menunggu. Tidak akan pernah ada waktu yang tepat.", author: "Napoleon Hill" },
        { text: "Kegagalan hanyalah kesempatan untuk memulai lagi dengan lebih cerdas.", author: "Henry Ford" },
        { text: "Sukses bukan kunci kebahagiaan. Kebahagiaan adalah kunci sukses.", author: "Albert Schweitzer" },
        { text: "Yang penting bukanlah apa yang terjadi padamu, tetapi bagaimana kamu bereaksi terhadapnya.", author: "Epictetus" },
        { text: "Keberanian bukan berarti tidak takut, tapi mampu menaklukkan rasa takut.", author: "Nelson Mandela" },
        { text: "Jangan tanya apa yang bisa negara berikan padamu, tapi tanyakan apa yang bisa kamu berikan untuk negara.", author: "John F. Kennedy" },
        { text: "Mimpi tanpa tindakan hanyalah angan-angan. Tindakan tanpa mimpi adalah membuang waktu. Mimpi dengan tindakan bisa mengubah dunia.", author: "Joel Barker" },
        { text: "Kesabaran, ketekunan, dan keringat adalah kombinasi yang tak terkalahkan untuk sukses.", author: "Napoleon Hill" },
        { text: "Pendidikan adalah paspor menuju masa depan, karena hari esok adalah milik mereka yang mempersiapkannya hari ini.", author: "Malcolm X" },
        { text: "Apa yang kita pikirkan, kita menjadi apa yang kita pikirkan.", author: "Buddha" },
        { text: "Tidak ada elevator menuju sukses. Kamu harus naik tangga.", author: "Zig Ziglar" },
        { text: "Pendidikan adalah kunci untuk membuka pintu emas kebebasan.", author: "George Washington Carver" },
        { text: "Guru biasa memberitahu. Guru baik menjelaskan. Guru ulung mendemonstrasikan. Guru hebat menginspirasi.", author: "William Arthur Ward" },
        { text: "Pengajaran yang baik adalah seperempat persiapan dan tiga perempat teater.", author: "Gail Godwin" },
        { text: "Satu buku, satu pena, satu anak, dan satu guru dapat mengubah dunia.", author: "Malala Yousafzai" },
        { text: "Jika kamu tidak dapat mengajar orang lain apa yang kamu ketahui, maka kamu tidak benar-benar mengetahuinya.", author: "Pepatah" },
        { text: "Sukses adalah kemampuan untuk melangkah dari satu kegagalan ke kegagalan lain tanpa kehilangan antusiasme.", author: "Winston Churchill" },
        { text: "Orang yang paling berpengaruh dalam hidupmu adalah dirimu sendiri. Percakapan yang paling penting adalah percakapan dengan dirimu sendiri.", author: "David J. Schwartz" },
        { text: "Kesempatan besar untuk membantu orang lain jarang datang, tapi kesempatan kecil mengelilingi kita setiap hari.", author: "Sally Koch" },
        { text: "Hal tersulit adalah keputusan untuk bertindak, sisanya hanya ketekunan.", author: "Amelia Earhart" },
        { text: "Kepercayaan adalah hal yang paling sulit untuk diperoleh dan paling mudah untuk hilang.", author: "Anonim" },
        { text: "Keunggulan bukanlah keterampilan, tetapi sikap.", author: "Ralph Marston" },
        { text: "Kemarin adalah sejarah. Besok adalah misteri. Hari ini adalah anugerah. Itulah mengapa disebut present (hadiah).", author: "Eleanor Roosevelt" },
        { text: "Hidup adalah 10% apa yang terjadi padamu dan 90% bagaimana kamu menanggapinya.", author: "Charles R. Swindoll" },
        { text: "Jangan pernah meremehkan perbedaan yang bisa kamu buat.", author: "Anonim" },
        { text: "Seorang pemimpin adalah seseorang yang mengetahui jalan, berjalan di jalan itu, dan menunjukkan jalan itu.", author: "John C. Maxwell" },
        { text: "Ilmu pengetahuan tanpa agama adalah lumpuh, agama tanpa ilmu pengetahuan adalah buta.", author: "Albert Einstein" },
        { text: "Karakter tidak dibangun dalam kemudahan dan ketenangan. Hanya melalui pengalaman cobaan dan penderitaan jiwa dapat diperkuat.", author: "Helen Keller" },
        { text: "Jangan biarkan apa yang tidak bisa kamu lakukan menghalangi apa yang bisa kamu lakukan.", author: "John Wooden" },
        { text: "Kehebatan tidak pernah terjadi secara kebetulan, selalu merupakan hasil dari niat yang tinggi, usaha yang tulus, dan pelaksanaan yang terampil.", author: "Aristoteles" },
        { text: "Kreativitas adalah kecerdasan yang bersenang-senang.", author: "Albert Einstein" },
        { text: "Perbedaan antara menang dan kalah seringkali adalah tidak menyerah.", author: "Walt Disney" },
        { text: "Kamu tidak akan pernah terlalu tua untuk menetapkan tujuan lain atau untuk bermimpi impian baru.", author: "C.S. Lewis" },
        { text: "Kesuksesan sejati diukur dari seberapa banyak kali kamu bisa bangkit kembali.", author: "Stephen Richards" },
        { text: "Jangan menghitung hari, buatlah hari-hari itu berarti.", author: "Muhammad Ali" },
        { text: "Pendidikan adalah pembelajaran apa yang bahkan tidak kamu tahu bahwa kamu tidak tahu.", author: "Daniel J. Boorstin" },
        { text: "Guru yang hebat tidak mengajar dari buku, tetapi dari hati.", author: "Anonim" },
        { text: "Kepemimpinan dan pembelajaran sangat diperlukan satu sama lain.", author: "John F. Kennedy" },
        { text: "Masa depan tergantung pada apa yang kamu lakukan hari ini.", author: "Mahatma Gandhi" },
        { text: "Kejujuran adalah bab pertama dalam buku kebijaksanaan.", author: "Thomas Jefferson" },
        { text: "Dalam pembelajaran, kamu akan mengajar. Dalam mengajar, kamu akan belajar.", author: "Phil Collins" },
        { text: "Belajarlah dari kemarin, hiduplah untuk hari ini, berharaplah untuk besok.", author: "Albert Einstein" },
        { text: "Tidak ada yang dapat mengganggu orang yang telah menemukan kedamaian dalam dirinya sendiri.", author: "Buddha" },
        { text: "Kemenangan terbesar adalah kemenangan atas diri sendiri.", author: "Plato" },
        { text: "Perjalanan seribu mil dimulai dengan satu langkah.", author: "Lao Tzu" },
        { text: "Kesuksesan adalah mendapatkan apa yang kamu inginkan. Kebahagiaan adalah menginginkan apa yang kamu dapatkan.", author: "Dale Carnegie" },
        { text: "Orang bijak belajar dari kesalahan orang lain. Orang bodoh belajar dari kesalahannya sendiri.", author: "Pepatah Latin" },
        { text: "Pekerjaan yang baik dan kerja keras tidak ada gantinya.", author: "Sidney Sheldon" },
        { text: "Sikap positif mengubah mimpi menjadi kenyataan.", author: "Anonim" },
        { text: "Kegigihan adalah rahasia dari semua kemenangan.", author: "Victor Hugo" },
        { text: "Jangan pernah kehilangan kesempatan untuk membuat seseorang tersenyum.", author: "Roy T. Bennett" },
        { text: "Keberhasilan bukanlah milik orang pintar, tetapi milik orang yang pantang menyerah.", author: "B.J. Habibie" },
        { text: "Ilmu itu lebih baik daripada harta. Ilmu menjaga engkau dan engkau menjaga harta.", author: "Ali bin Abi Thalib" },
        { text: "Orang hebat bukan yang tidak pernah jatuh, tetapi orang yang selalu bangkit setiap kali jatuh.", author: "Confucius" },
        { text: "Kesempatan itu seperti matahari terbit. Jika kamu menunggu terlalu lama, kamu akan melewatkannya.", author: "William Arthur Ward" },
        { text: "Jangan takut tumbuh lambat, takutlah hanya berdiri diam.", author: "Pepatah Tiongkok" },
        { text: "Kebaikan adalah bahasa yang dapat didengar oleh orang tuli dan dilihat oleh orang buta.", author: "Mark Twain" },
        { text: "Bukan masalahnya yang penting, tetapi bagaimana kita menyikapi masalah itu.", author: "Epictetus" },
        { text: "Kesuksesan adalah hasil dari persiapan, kerja keras, dan belajar dari kegagalan.", author: "Colin Powell" },
        { text: "Pendidikan adalah senjata paling kuat untuk mengubah dunia menjadi lebih baik.", author: "Nelson Mandela" },
        { text: "Hidup ini seperti mengendarai sepeda. Untuk menjaga keseimbangan, kamu harus terus bergerak.", author: "Albert Einstein" },
        { text: "Berpikirlah besar dan jangan dengarkan orang-orang yang mengatakan itu tidak mungkin.", author: "Tim Ferriss" },
        { text: "Setiap ahli pernah menjadi pemula. Jangan takut untuk memulai.", author: "Robin Sharma" },
        { text: "Kesabaran adalah kunci kesuksesan. Orang yang sabar akan mencapai tujuannya.", author: "Anonim" },
        { text: "Jangan menunda sampai besok apa yang bisa kamu lakukan hari ini.", author: "Benjamin Franklin" },
        { text: "Keberhasilan adalah perjalanan, bukan tujuan.", author: "Ben Sweetland" },
        { text: "Percayalah pada dirimu sendiri dan semua yang kamu miliki.", author: "Christian D. Larson" },
        { text: "Waktu tidak menunggu siapa pun. Manfaatkan setiap detiknya dengan bijak.", author: "Anonim" },
      ];

      // Get random quote
      function getTodayQuote() {
        const randomIndex = Math.floor(Math.random() * quotes.length);
        return quotes[randomIndex];
      }

      // Display quote
      function displayQuote() {
        const quote = getTodayQuote();
        document.getElementById("quote-text").textContent = '"' + quote.text + '"';
        document.getElementById("quote-author").textContent = "‚Äî " + quote.author;
      }

      // Parallax Scrolling Effect
      function setupParallax() {
        const app = document.getElementById("app");
        const parallaxBg = document.querySelector(".parallax-bg");

        if (!parallaxBg) return;

        app.addEventListener("scroll", () => {
          const scrolled = app.scrollTop;
          const parallaxSpeed = 0.5;

          if (parallaxBg) {
            parallaxBg.style.transform = "translateY(" + scrolled * parallaxSpeed + "px)";
          }
        });
      }

      // Initialize Particles.js
      function initParticles() {
        if (window.particlesJS) {
          particlesJS("particles-js", {
            particles: {
              number: {
                value: 80,
                density: {
                  enable: true,
                  value_area: 800,
                },
              },
              color: {
                value: "#f97316",
              },
              shape: {
                type: "circle",
                stroke: {
                  width: 0,
                  color: "#000000",
                },
              },
              opacity: {
                value: 0.3,
                random: true,
                anim: {
                  enable: true,
                  speed: 1,
                  opacity_min: 0.1,
                  sync: false,
                },
              },
              size: {
                value: 3,
                random: true,
                anim: {
                  enable: true,
                  speed: 2,
                  size_min: 0.1,
                  sync: false,
                },
              },
              line_linked: {
                enable: true,
                distance: 150,
                color: "#cbd5e1",
                opacity: 0.2,
                width: 1,
              },
              move: {
                enable: true,
                speed: 1,
                direction: "none",
                random: true,
                straight: false,
                out_mode: "out",
                bounce: false,
                attract: {
                  enable: false,
                  rotateX: 600,
                  rotateY: 1200,
                },
              },
            },
            interactivity: {
              detect_on: "canvas",
              events: {
                onhover: {
                  enable: true,
                  mode: "grab",
                },
                onclick: {
                  enable: true,
                  mode: "push",
                },
                resize: true,
              },
              modes: {
                grab: {
                  distance: 140,
                  line_linked: {
                    opacity: 0.5,
                  },
                },
                push: {
                  particles_nb: 4,
                },
              },
            },
            retina_detect: true,
          });
        }
      }

      // Pull to Refresh State
      let startY = 0;
      let currentY = 0;
      let isPulling = false;
      let isRefreshing = false;

      // Pull to Refresh Setup
      function setupPullToRefresh() {
        const app = document.getElementById("app");
        const indicator = document.getElementById("pull-to-refresh-indicator");
        const pullIcon = document.getElementById("pull-icon");
        const pullSpinner = document.getElementById("pull-spinner");

        app.addEventListener(
          "touchstart",
          (e) => {
            if (app.scrollTop === 0 && !isRefreshing) {
              startY = e.touches[0].pageY;
              isPulling = true;
            }
          },
          { passive: true },
        );

        app.addEventListener(
          "touchmove",
          (e) => {
            if (!isPulling || isRefreshing) return;

            currentY = e.touches[0].pageY;
            const pullDistance = currentY - startY;

            if (pullDistance > 0 && pullDistance < 100) {
              indicator.style.top = pullDistance - 80 + "px";
              const rotation = (pullDistance / 100) * 180;
              pullIcon.style.transform = "rotate(" + rotation + "deg)";
            } else if (pullDistance >= 100) {
              indicator.classList.add("pulling");
              pullIcon.classList.add("rotate");
            }
          },
          { passive: true },
        );

        app.addEventListener("touchend", async (e) => {
          if (!isPulling || isRefreshing) return;

          const pullDistance = currentY - startY;

          if (pullDistance >= 100) {
            isRefreshing = true;
            indicator.classList.add("refreshing");
            pullIcon.classList.add("hidden");
            pullSpinner.classList.remove("hidden");

            // Refresh data
            await loadAllData();

            // Show success message
            showToast("Data berhasil diperbarui!", "success");

            // Reset after delay
            setTimeout(() => {
              indicator.classList.remove("pulling", "refreshing");
              indicator.style.top = "-80px";
              pullIcon.style.transform = "rotate(0deg)";
              pullIcon.classList.remove("rotate", "hidden");
              pullSpinner.classList.add("hidden");
              isRefreshing = false;
            }, 500);
          } else {
            indicator.style.top = "-80px";
            indicator.classList.remove("pulling");
            pullIcon.style.transform = "rotate(0deg)";
            pullIcon.classList.remove("rotate");
          }

          isPulling = false;
          startY = 0;
          currentY = 0;
        });
      }

      // Dark Mode Functions
      const DARK_MODE_KEY = "dark_mode_enabled";

      function isDarkMode() {
        return localStorage.getItem(DARK_MODE_KEY) === "true";
      }

      function toggleDarkMode() {
        const isDark = isDarkMode();

        if (isDark) {
          document.body.classList.remove("dark-mode");
          localStorage.setItem(DARK_MODE_KEY, "false");
          document.getElementById("dark-mode-icon-sun").classList.add("hidden");
          document.getElementById("dark-mode-icon-moon").classList.remove("hidden");
        } else {
          document.body.classList.add("dark-mode");
          localStorage.setItem(DARK_MODE_KEY, "true");
          document.getElementById("dark-mode-icon-sun").classList.remove("hidden");
          document.getElementById("dark-mode-icon-moon").classList.add("hidden");
        }
      }

      function initDarkMode() {
        if (isDarkMode()) {
          document.body.classList.add("dark-mode");
          document.getElementById("dark-mode-icon-sun").classList.remove("hidden");
          document.getElementById("dark-mode-icon-moon").classList.add("hidden");
        } else {
          document.body.classList.remove("dark-mode");
          document.getElementById("dark-mode-icon-sun").classList.add("hidden");
          document.getElementById("dark-mode-icon-moon").classList.remove("hidden");
        }
      }

      // Loading Overlay Functions
      function showLoading() {
        document.getElementById("loading-overlay").classList.remove("hidden");
        document.getElementById("loading-overlay").classList.add("flex");
      }

      function hideLoading() {
        document.getElementById("loading-overlay").classList.add("hidden");
        document.getElementById("loading-overlay").classList.remove("flex");
      }

      // Empty State Functions
      function showEmptyStaff() {
        const container = document.getElementById("staff-list");
        container.innerHTML =
          '<div class="empty-state"><svg class="empty-state-icon mx-auto" viewBox="0 0 200 200" fill="none"><circle cx="100" cy="80" r="30" fill="#cbd5e1"/><path d="M60 140c0-22 18-40 40-40s40 18 40 40" stroke="#cbd5e1" stroke-width="8" stroke-linecap="round"/><circle cx="85" cy="75" r="5" fill="#64748b"/><circle cx="115" cy="75" r="5" fill="#64748b"/><path d="M90 90c5 5 15 5 20 0" stroke="#64748b" stroke-width="3" stroke-linecap="round"/></svg><h3 class="text-lg font-bold text-slate-700 mb-2">Belum Ada Guru/Staff</h3><p class="text-slate-500 text-sm">Tambahkan guru atau staff menggunakan form di atas</p></div>';
      }

      function showEmptyAttendance() {
        const container = document.getElementById("attendance-records");
        container.innerHTML =
          '<div class="empty-state"><svg class="empty-state-icon mx-auto" viewBox="0 0 200 200" fill="none"><rect x="50" y="40" width="100" height="120" rx="10" fill="#e2e8f0" stroke="#cbd5e1" stroke-width="4"/><line x1="70" y1="70" x2="130" y2="70" stroke="#94a3b8" stroke-width="4" stroke-linecap="round"/><line x1="70" y1="90" x2="130" y2="90" stroke="#94a3b8" stroke-width="4" stroke-linecap="round"/><line x1="70" y1="110" x2="110" y2="110" stroke="#94a3b8" stroke-width="4" stroke-linecap="round"/><circle cx="70" cy="70" r="4" fill="#64748b"/><circle cx="70" cy="90" r="4" fill="#64748b"/><circle cx="70" cy="110" r="4" fill="#64748b"/></svg><h3 class="text-lg font-bold text-slate-700 mb-2">Belum Ada Data Absensi</h3><p class="text-slate-500 text-sm">Data absensi akan muncul di sini setelah guru/staff melakukan absensi</p></div>';
      }

      function showEmptyFilteredAttendance() {
        const container = document.getElementById("attendance-records");
        container.innerHTML =
          '<div class="empty-state"><svg class="empty-state-icon mx-auto" viewBox="0 0 200 200" fill="none"><circle cx="80" cy="80" r="40" fill="none" stroke="#cbd5e1" stroke-width="6"/><line x1="110" y1="110" x2="140" y2="140" stroke="#cbd5e1" stroke-width="6" stroke-linecap="round"/><line x1="60" y1="70" x2="100" y2="70" stroke="#94a3b8" stroke-width="4" stroke-linecap="round"/><line x1="60" y1="85" x2="90" y2="85" stroke="#94a3b8" stroke-width="4" stroke-linecap="round"/></svg><h3 class="text-lg font-bold text-slate-700 mb-2">Tidak Ada Data</h3><p class="text-slate-500 text-sm">Tidak ada data absensi yang sesuai dengan filter</p></div>';
      }

      // Default Config
      const defaultConfig = {
        app_title: "Absensi",
        school_name: "SMK YPPM TOMO",
        apps_script_url: "https://script.google.com/macros/s/AKfycbxCDspWWAsHs1labW5J5yzqVIwftC0DWOT-4q8NXhB028D2GCUO4UKu3Nd_8DWUyWe2KQ/exec",
      };

      // Initialize Element SDK
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange: async (config) => {
            const title = config.app_title || defaultConfig.app_title;
            const school = config.school_name || defaultConfig.school_name;

            document.getElementById("header-title").textContent = title;
            document.getElementById("header-school").textContent = school;
            document.title = title + " - " + school;
          },
          mapToCapabilities: (config) => ({
            recolorables: [],
            borderables: [],
            fontEditable: undefined,
            fontSizeable: undefined,
          }),
          mapToEditPanelValues: (config) =>
            new Map([
              ["app_title", config.app_title || defaultConfig.app_title],
              ["school_name", config.school_name || defaultConfig.school_name],
              ["apps_script_url", config.apps_script_url || defaultConfig.apps_script_url],
            ]),
        });
      }

      // Get Apps Script URL
      function getAppsScriptUrl() {
        if (window.elementSdk && window.elementSdk.config) {
          return window.elementSdk.config.apps_script_url || defaultConfig.apps_script_url;
        }
        return defaultConfig.apps_script_url;
      }

      // Hide Initial Loading Screen
      function hideInitialLoading() {
        const loadingScreen = document.getElementById("initial-loading");
        if (loadingScreen) {
          loadingScreen.style.animation = "fadeOut 0.5s ease-out forwards";
          setTimeout(() => {
            loadingScreen.remove();
          }, 500);
        }
      }

      // Initialize App
      async function initApp() {
        initDarkMode();
        updateDateTime();
        setInterval(updateDateTime, 1000);

        // Initialize new features
        displayQuote();
        initParticles();
        setupParallax();

        // PWA Install handling
        setupPWA();

        // Setup Pull to Refresh
        setupPullToRefresh();

        // Get location automatically
        getLocation();

        // Load data from Apps Script
        await loadAllData();

        // Hide loading screen after everything is loaded
        hideInitialLoading();
      }

      // Load all data from Google Sheets
      async function loadAllData() {
        const url = getAppsScriptUrl();

        if (!url) {
          console.error("Apps Script URL tidak dikonfigurasi");
          return;
        }

        if (isLoading) return;
        isLoading = true;

        showLoading();

        try {
          const response = await fetch(url + "?action=getAll");
          const data = await response.json();

          if (data.success) {
            staffList = data.staff || [];
            attendanceList = data.attendance || [];

            updateStaffSelect();
            updateStaffList();
            updateAttendanceRecords();
          }
        } catch (error) {
          console.error("Error loading data:", error);
          showToast("Gagal memuat data", "error");
        } finally {
          hideLoading();
          isLoading = false;
        }
      }

      // PWA Setup
      function setupPWA() {
        // Check if app is already installed
        if (window.matchMedia("(display-mode: standalone)").matches || window.navigator.standalone === true) {
          // App is installed, hide install button
          document.getElementById("header-install-btn").style.display = "none";
        }

        window.addEventListener("beforeinstallprompt", (e) => {
          e.preventDefault();
          deferredPrompt = e;
          // Show install button when prompt is available
          document.getElementById("header-install-btn").style.display = "flex";
        });

        window.addEventListener("appinstalled", () => {
          showToast("Aplikasi berhasil diinstall!", "success");
          // Hide install button after installation
          document.getElementById("header-install-btn").style.display = "none";
          deferredPrompt = null;
        });
      }

      async function installPWA() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          const { outcome } = await deferredPrompt.userChoice;
          if (outcome === "accepted") {
            showToast("Terima kasih telah menginstall aplikasi!", "success");
          }
          deferredPrompt = null;
        } else {
          showToast('Untuk menginstall, gunakan menu browser dan pilih "Add to Home Screen" atau "Install App"', "info");
        }
      }

      // Toast Notification
      function showToast(message, type = "info") {
        const container = document.getElementById("toast-container");
        const toast = document.createElement("div");

        const colors = {
          success: "bg-gradient-to-r from-slate-600 to-slate-700",
          error: "bg-gradient-to-r from-red-500 to-rose-600",
          info: "bg-gradient-to-r from-slate-500 to-slate-600",
          warning: "bg-gradient-to-r from-amber-500 to-orange-600",
        };

        toast.className = "toast " + colors[type] + " text-white px-6 py-4 rounded-2xl shadow-2xl font-bold text-sm max-w-xs text-center";
        toast.textContent = message;

        container.appendChild(toast);

        setTimeout(() => {
          toast.remove();
        }, 3000);
      }

      // Date Time Update
      function updateDateTime() {
        const now = new Date();
        const options = { weekday: "long", year: "numeric", month: "long", day: "numeric" };
        document.getElementById("current-date").textContent = now.toLocaleDateString("id-ID", options);
        document.getElementById("current-time").textContent = now.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit", second: "2-digit" });

        // Update analog clock
        updateAnalogClock(now);
      }

      // Update Analog Clock
      function updateAnalogClock(date) {
        const hours = date.getHours();
        const minutes = date.getMinutes();
        const seconds = date.getSeconds();

        // Calculate angles (12 o'clock is 0 degrees)
        const secondAngle = seconds * 6 - 90; // 6 degrees per second
        const minuteAngle = minutes * 6 + seconds * 0.1 - 90; // 6 degrees per minute + smooth transition
        const hourAngle = (hours % 12) * 30 + minutes * 0.5 - 90; // 30 degrees per hour + smooth transition

        // Get hand elements
        const hourHand = document.getElementById("hour-hand");
        const minuteHand = document.getElementById("minute-hand");
        const secondHand = document.getElementById("second-hand");

        if (hourHand && minuteHand && secondHand) {
          // Update hour hand (length: 20 units from center)
          const hourX = 50 + 20 * Math.cos((hourAngle * Math.PI) / 180);
          const hourY = 50 + 20 * Math.sin((hourAngle * Math.PI) / 180);
          hourHand.setAttribute("x2", hourX);
          hourHand.setAttribute("y2", hourY);

          // Update minute hand (length: 30 units from center)
          const minuteX = 50 + 30 * Math.cos((minuteAngle * Math.PI) / 180);
          const minuteY = 50 + 30 * Math.sin((minuteAngle * Math.PI) / 180);
          minuteHand.setAttribute("x2", minuteX);
          minuteHand.setAttribute("y2", minuteY);

          // Update second hand (length: 35 units from center)
          const secondX = 50 + 35 * Math.cos((secondAngle * Math.PI) / 180);
          const secondY = 50 + 35 * Math.sin((secondAngle * Math.PI) / 180);
          secondHand.setAttribute("x2", secondX);
          secondHand.setAttribute("y2", secondY);
        }
      }

      // Page Navigation
      function showPage(page) {
        document.querySelectorAll(".page").forEach((p) => p.classList.remove("active"));
        document.getElementById("page-" + page).classList.add("active");
        window.scrollTo(0, 0);
      }

      // Status Selection
      function selectStatus(status) {
        selectedStatus = status;
        document.querySelectorAll(".status-option").forEach((card) => {
          card.classList.remove("selected");
        });

        const selectedCard = document.querySelector('[data-status="' + status + '"]');
        selectedCard.classList.add("selected");

        // Re-check for duplicate when status changes
        checkDuplicateAttendance();

        // Update progress
        updateProgressIndicator();
      }

      // Camera Functions
      async function startCamera() {
        try {
          cameraStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: "user", width: { ideal: 640 }, height: { ideal: 480 } },
          });

          const video = document.getElementById("camera-video");
          video.srcObject = cameraStream;
          video.play();

          document.getElementById("camera-placeholder").classList.add("hidden");
          document.getElementById("open-camera-btn").classList.add("hidden");
          video.classList.remove("hidden");
          document.getElementById("camera-controls").classList.remove("hidden");
        } catch (err) {
          showToast("Tidak dapat mengakses kamera. Pastikan izin kamera diberikan.", "error");
        }
      }

      function capturePhoto() {
        const video = document.getElementById("camera-video");
        const canvas = document.getElementById("camera-canvas");
        const photo = document.getElementById("captured-photo");

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;

        const ctx = canvas.getContext("2d");
        ctx.translate(canvas.width, 0);
        ctx.scale(-1, 1);
        ctx.drawImage(video, 0, 0);

        capturedPhotoData = canvas.toDataURL("image/jpeg", 0.7);
        photo.src = capturedPhotoData;

        stopCamera();
        document.getElementById("camera-placeholder").classList.add("hidden");
        document.getElementById("open-camera-btn").classList.add("hidden");
        video.classList.add("hidden");
        document.getElementById("camera-controls").classList.add("hidden");
        photo.classList.remove("hidden");
        document.getElementById("photo-controls").classList.remove("hidden");

        checkFormValidity();
      }

      function stopCamera() {
        if (cameraStream) {
          cameraStream.getTracks().forEach((track) => track.stop());
          cameraStream = null;
        }

        // Hide video and controls, show placeholder
        document.getElementById("camera-video").classList.add("hidden");
        document.getElementById("camera-controls").classList.add("hidden");
        document.getElementById("camera-placeholder").classList.remove("hidden");
      }

      function retakePhoto() {
        capturedPhotoData = null;
        document.getElementById("captured-photo").classList.add("hidden");
        document.getElementById("photo-controls").classList.add("hidden");
        document.getElementById("camera-placeholder").classList.remove("hidden");
        document.getElementById("open-camera-btn").classList.remove("hidden");
        checkFormValidity();
      }

      // Location Functions
      async function getLocation() {
        if (!navigator.geolocation) {
          showToast("Geolokasi tidak didukung di browser ini", "error");
          document.getElementById("location-loading").innerHTML =
            '<svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><p class="text-slate-700 font-semibold">Geolokasi tidak didukung</p>';
          return;
        }

        navigator.geolocation.getCurrentPosition(
          async (position) => {
            currentLocation = {
              lat: position.coords.latitude,
              lng: position.coords.longitude,
            };

            // Get address using reverse geocoding
            try {
              const response = await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=" + currentLocation.lat + "&lon=" + currentLocation.lng);
              const data = await response.json();
              currentLocation.address = data.display_name || "Alamat tidak ditemukan";
            } catch (err) {
              currentLocation.address = "Alamat tidak dapat diambil";
            }

            document.getElementById("location-loading").classList.add("hidden");
            document.getElementById("location-result").classList.remove("hidden");
            document.getElementById("location-address").textContent = currentLocation.address;
            document.getElementById("location-coords").textContent = "Koordinat: " + currentLocation.lat.toFixed(6) + ", " + currentLocation.lng.toFixed(6);

            // Initialize map
            if (map) {
              map.remove();
            }

            map = L.map("map").setView([currentLocation.lat, currentLocation.lng], 17);
            L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
              attribution: "¬© OpenStreetMap",
            }).addTo(map);

            L.marker([currentLocation.lat, currentLocation.lng]).addTo(map).bindPopup("Lokasi Anda").openPopup();

            checkFormValidity();
          },
          (error) => {
            let message = "Gagal mendapatkan lokasi";

            if (error.code === 1) {
              message = "Izin lokasi ditolak. Aktifkan izin lokasi untuk melanjutkan.";
            }
            if (error.code === 2) {
              message = "Lokasi tidak tersedia";
            }
            if (error.code === 3) {
              message = "Waktu habis mendapatkan lokasi";
            }

            document.getElementById("location-loading").innerHTML =
              '<svg class="w-16 h-16 text-red-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg><p class="text-slate-700 font-semibold text-center px-4">' +
              message +
              "</p>";

            showToast(message, "error");
          },
          { enableHighAccuracy: true, timeout: 15000 },
        );
      }

      // Check Duplicate Attendance
      function checkDuplicateAttendance() {
        const staffSelect = document.getElementById("staff-select");
        const selectedName = staffSelect.value;
        const warningDiv = document.getElementById("duplicate-warning");
        const detailsP = document.getElementById("duplicate-details");

        if (!selectedName) {
          warningDiv.classList.add("hidden");
          checkFormValidity();
          return;
        }

        // Get today's date
        const today = new Date().toISOString().split("T")[0];

        // Find all attendance records for this person today
        const todayRecords = attendanceList.filter((record) => {
          let recordDate = record.date;

          // Extract date from ISO timestamp if needed
          if (recordDate && recordDate.includes("T")) {
            recordDate = recordDate.split("T")[0];
          }

          return record.name === selectedName && recordDate === today;
        });

        if (todayRecords.length > 0) {
          // Show warning with details
          const statusLabels = {
            masuk: "Masuk",
            pulang: "Pulang",
            dinas: "Dinas Luar",
          };

          const recordsText = todayRecords
            .map((r) => {
              const status = statusLabels[r.status] || r.status;
              const time = r.time || "00:00";
              return "<strong>" + status + "</strong> pukul " + time;
            })
            .join(", ");

          detailsP.innerHTML = selectedName + " sudah melakukan absensi hari ini: " + recordsText + ". Silakan pilih status yang berbeda atau pastikan tidak ada duplikasi.";
          warningDiv.classList.remove("hidden");
        } else {
          // No duplicate found
          warningDiv.classList.add("hidden");
        }

        checkFormValidity();
      }

      // Form Validation
      function checkFormValidity() {
        const staffSelect = document.getElementById("staff-select");
        const isValid = staffSelect.value && selectedStatus && capturedPhotoData && currentLocation;
        document.getElementById("submit-btn").disabled = !isValid;

        // Update progress indicator
        updateProgressIndicator();
      }

      // Update Progress Indicator
      function updateProgressIndicator() {
        const staffSelect = document.getElementById("staff-select");
        const hasName = staffSelect.value !== "";
        const hasStatus = selectedStatus !== null;
        const hasPhoto = capturedPhotoData !== null;
        const hasLocation = currentLocation !== null;

        // Step 1: Name
        const step1 = document.getElementById("progress-step-1");
        const bar1 = document.getElementById("progress-bar-1");
        if (hasName) {
          step1.classList.add("completed");
          step1.classList.remove("active");
          bar1.style.width = "100%";
        } else {
          step1.classList.add("active");
          step1.classList.remove("completed");
          bar1.style.width = "0%";
        }

        // Step 2: Status
        const step2 = document.getElementById("progress-step-2");
        const bar2 = document.getElementById("progress-bar-2");
        if (hasStatus) {
          step2.classList.add("completed");
          step2.classList.remove("active");
          bar2.style.width = "100%";
        } else if (hasName) {
          step2.classList.add("active");
          step2.classList.remove("completed");
          bar2.style.width = "0%";
        } else {
          step2.classList.remove("active", "completed");
          bar2.style.width = "0%";
        }

        // Step 3: Photo
        const step3 = document.getElementById("progress-step-3");
        const bar3 = document.getElementById("progress-bar-3");
        if (hasPhoto) {
          step3.classList.add("completed");
          step3.classList.remove("active");
          bar3.style.width = "100%";
        } else if (hasStatus) {
          step3.classList.add("active");
          step3.classList.remove("completed");
          bar3.style.width = "0%";
        } else {
          step3.classList.remove("active", "completed");
          bar3.style.width = "0%";
        }

        // Step 4: Complete
        const step4 = document.getElementById("progress-step-4");
        if (hasName && hasStatus && hasPhoto && hasLocation) {
          step4.classList.add("completed");
          step4.classList.remove("active");
        } else if (hasPhoto) {
          step4.classList.add("active");
          step4.classList.remove("completed");
        } else {
          step4.classList.remove("active", "completed");
        }
      }

      // Show Success Modal
      function showSuccessModal(name, status, time) {
        const statusLabels = {
          masuk: "Masuk",
          pulang: "Pulang",
          dinas: "Dinas Luar",
        };

        const details = name + " - " + statusLabels[status] + " pada " + time;
        document.getElementById("success-details").textContent = details;
        document.getElementById("success-modal").classList.remove("hidden");
      }

      // Confetti Animation
      function createConfetti() {
        const colors = ["#f97316", "#fb923c", "#fbbf24", "#34d399", "#60a5fa", "#a78bfa", "#f472b6"];
        const confettiCount = 150;

        for (let i = 0; i < confettiCount; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti confetti-particle";

          // Random properties
          const left = Math.random() * 100;
          const animationDuration = Math.random() * 3 + 2; // 2-5 seconds
          const animationDelay = Math.random() * 0.5; // 0-0.5s delay
          const color = colors[Math.floor(Math.random() * colors.length)];
          const size = Math.random() * 8 + 6; // 6-14px

          confetti.style.left = left + "%";
          confetti.style.backgroundColor = color;
          confetti.style.width = size + "px";
          confetti.style.height = size + "px";
          confetti.style.animationDuration = animationDuration + "s";
          confetti.style.animationDelay = animationDelay + "s";
          confetti.style.borderRadius = Math.random() > 0.5 ? "50%" : "2px";

          document.body.appendChild(confetti);

          // Remove confetti after animation
          setTimeout(
            () => {
              confetti.remove();
            },
            (animationDuration + animationDelay) * 1000,
          );
        }
      }

      // Close Success Modal
      async function closeSuccessModal() {
        document.getElementById("success-modal").classList.add("hidden");

        // Reset form after closing success modal
        resetForm();

        // Reload data from server to update dashboard
        await loadAllData();
      }

      // Show Submit Confirmation
      function submitAttendance() {
        const staffSelect = document.getElementById("staff-select");
        const selectedName = staffSelect.value;

        if (!selectedName || !selectedStatus || !capturedPhotoData || !currentLocation) {
          showToast("Lengkapi semua data terlebih dahulu", "error");
          return;
        }

        const url = getAppsScriptUrl();
        if (!url) {
          showToast("URL Apps Script belum dikonfigurasi. Klik tombol pengaturan untuk menambahkan URL.", "error");
          return;
        }

        // Check for duplicate attendance
        const today = new Date().toISOString().split("T")[0];
        const duplicate = attendanceList.find((record) => {
          let recordDate = record.date;

          // Extract date from ISO timestamp if needed
          if (recordDate && recordDate.includes("T")) {
            recordDate = recordDate.split("T")[0];
          }

          return record.name === selectedName && record.status === selectedStatus && recordDate === today;
        });

        if (duplicate) {
          const statusLabels = {
            masuk: "Masuk",
            pulang: "Pulang",
            dinas: "Dinas Luar",
          };

          showToast(selectedName + " sudah absen " + statusLabels[selectedStatus] + " hari ini!", "warning");
          return;
        }

        // Show confirmation modal
        const statusLabels = {
          masuk: "Masuk",
          pulang: "Pulang",
          dinas: "Dinas Luar",
        };

        const now = new Date();
        document.getElementById("confirm-name").textContent = selectedName;
        document.getElementById("confirm-status").textContent = statusLabels[selectedStatus];
        document.getElementById("confirm-time").textContent =
          now.toLocaleTimeString("id-ID", {
            hour: "2-digit",
            minute: "2-digit",
            second: "2-digit",
          }) +
          " - " +
          now.toLocaleDateString("id-ID", {
            day: "numeric",
            month: "short",
            year: "numeric",
          });

        document.getElementById("submit-confirmation-modal").classList.remove("hidden");
      }

      function closeSubmitConfirmation() {
        document.getElementById("submit-confirmation-modal").classList.add("hidden");
      }

      // Confirm Submit Attendance
      async function confirmSubmitAttendance() {
        if (isSubmitting) return;

        const staffSelect = document.getElementById("staff-select");
        const selectedName = staffSelect.value;

        if (!selectedName || !selectedStatus || !capturedPhotoData || !currentLocation) {
          showToast("Lengkapi semua data terlebih dahulu", "error");
          closeSubmitConfirmation();
          return;
        }

        const url = getAppsScriptUrl();
        if (!url) {
          showToast("URL Apps Script belum dikonfigurasi. Klik tombol pengaturan untuk menambahkan URL.", "error");
          closeSubmitConfirmation();
          return;
        }

        // DOUBLE CHECK untuk mencegah absen ganda sebelum kirim
        const today = new Date().toISOString().split("T")[0];
        const existingRecord = attendanceList.find((record) => {
          let recordDate = record.date;

          // Extract date from ISO timestamp if needed
          if (recordDate && recordDate.includes("T")) {
            recordDate = recordDate.split("T")[0];
          }

          return record.name === selectedName && record.status === selectedStatus && recordDate === today;
        });

        if (existingRecord) {
          const statusLabels = {
            masuk: "Masuk",
            pulang: "Pulang",
            dinas: "Dinas Luar",
          };

          showToast("‚ö†Ô∏è " + selectedName + " sudah absen " + statusLabels[selectedStatus] + " hari ini pukul " + existingRecord.time + "!", "warning");
          closeSubmitConfirmation();

          // Shake the form
          const container = document.querySelector("#page-attendance > div");
          container.style.animation = "shake 0.5s";
          setTimeout(() => {
            container.style.animation = "";
          }, 500);

          return;
        }

        isSubmitting = true;
        const confirmBtn = document.getElementById("confirm-submit-btn");
        confirmBtn.innerHTML = '<div class="w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>';
        confirmBtn.disabled = true;

        const now = new Date();
        const attendanceData = {
          action: "addAttendance",
          name: selectedName,
          date: now.toISOString().split("T")[0],
          time: now.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit", second: "2-digit" }),
          status: selectedStatus,
          photo: capturedPhotoData,
          latitude: currentLocation.lat,
          longitude: currentLocation.lng,
          address: currentLocation.address,
          timestamp: now.toISOString(),
        };

        try {
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify(attendanceData),
          });

          const result = await response.json();

          if (result.success) {
            closeSubmitConfirmation();

            // üéä Trigger confetti animation!
            createConfetti();

            // Show success modal with animation
            const statusLabels = {
              masuk: "Masuk",
              pulang: "Pulang",
              dinas: "Dinas Luar",
            };

            const timeStr = now.toLocaleTimeString("id-ID", {
              hour: "2-digit",
              minute: "2-digit",
              second: "2-digit",
            });

            showSuccessModal(selectedName, selectedStatus, timeStr);

            // DON'T reset or reload here - let the success modal button handle it
          } else {
            showToast(result.message || "Gagal menyimpan absensi", "error");
            confirmBtn.innerHTML = "Kirim";
            confirmBtn.disabled = false;
          }
        } catch (error) {
          showToast("Error mengirim data: " + error.message, "error");
          confirmBtn.innerHTML = "Kirim";
          confirmBtn.disabled = false;
        } finally {
          isSubmitting = false;
        }
      }

      // Reset Form
      function resetForm() {
        document.getElementById("staff-select").value = "";
        selectedStatus = null;
        capturedPhotoData = null;
        currentLocation = null;

        // Hide duplicate warning
        document.getElementById("duplicate-warning").classList.add("hidden");

        document.querySelectorAll(".status-option").forEach((card) => {
          card.classList.remove("selected");
        });

        document.getElementById("captured-photo").classList.add("hidden");
        document.getElementById("photo-controls").classList.add("hidden");
        document.getElementById("camera-placeholder").classList.remove("hidden");
        document.getElementById("open-camera-btn").classList.remove("hidden");

        document.getElementById("location-result").classList.add("hidden");
        document.getElementById("location-loading").classList.remove("hidden");
        document.getElementById("location-loading").innerHTML =
          '<div class="w-14 h-14 border-4 border-orange-500 border-t-transparent rounded-full animate-spin mb-4"></div><p class="text-slate-700 font-semibold">Mendapatkan lokasi otomatis...</p>';

        if (map) {
          map.remove();
          map = null;
        }

        document.getElementById("submit-btn").disabled = true;

        // Reset progress indicator
        updateProgressIndicator();

        // Smooth scroll to top
        window.scrollTo({ top: 0, behavior: "smooth" });

        // Get location again
        getLocation();
      }

      // Update Staff Select
      function updateStaffSelect() {
        const select = document.getElementById("staff-select");
        const currentValue = select.value;

        select.innerHTML = '<option value="">-- Pilih Nama Guru/Staff --</option>';

        staffList
          .sort((a, b) => a.name.localeCompare(b.name))
          .forEach((staff) => {
            const option = document.createElement("option");
            option.value = staff.name;
            option.textContent = staff.name;
            select.appendChild(option);
          });

        if (currentValue && staffList.some((s) => s.name === currentValue)) {
          select.value = currentValue;
        }

        select.onchange = checkFormValidity;
      }

      // Update Staff List (Admin)
      function updateStaffList() {
        const container = document.getElementById("staff-list");
        document.getElementById("staff-count").textContent = staffList.length;

        if (staffList.length === 0) {
          showEmptyStaff();
          return;
        }

        const staffHTML = staffList
          .sort((a, b) => a.name.localeCompare(b.name))
          .map((staff) => {
            const safeId = String(staff.id || "")
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#39;");
            const safeName = String(staff.name || "")
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#39;");

            return (
              '<div class="flex items-center justify-between p-4 bg-gradient-to-r from-slate-50 to-slate-100 rounded-2xl hover:shadow-md transition border-2 border-slate-200"><span class="font-bold text-slate-800">' +
              staff.name +
              '</span><div class="flex gap-2"><button onclick="showEditModal(\'' +
              safeId +
              "', '" +
              safeName +
              '\')" class="text-slate-600 hover:text-white hover:bg-slate-600 p-2.5 rounded-xl transition shadow-sm" title="Edit"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg></button><button onclick="showDeleteModal(\'staff\', \'' +
              safeId +
              "', '" +
              safeName +
              '\')" class="text-red-500 hover:text-white hover:bg-red-500 p-2.5 rounded-xl transition shadow-sm" title="Hapus"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg></button></div></div>'
            );
          })
          .join("");

        container.innerHTML = staffHTML;

        // Update filter name dropdown
        updateFilterNameDropdown();
      }

      // Update Filter Name Dropdown
      function updateFilterNameDropdown() {
        const filterName = document.getElementById("filter-name");
        const currentValue = filterName.value;

        // Get unique names from staff list
        const uniqueNames = [...new Set(staffList.map((s) => s.name))].sort();

        filterName.innerHTML = '<option value="">üßë‚Äçüè´ Semua Guru/Staff</option>';
        uniqueNames.forEach((name) => {
          const option = document.createElement("option");
          option.value = name;
          option.textContent = name;
          filterName.appendChild(option);
        });

        // Restore previous selection if still valid
        if (currentValue && uniqueNames.includes(currentValue)) {
          filterName.value = currentValue;
        }
      }

      // Update Attendance Records (Admin)
      function updateAttendanceRecords() {
        filterAttendance();
      }

      function clearFilter() {
        document.getElementById("filter-date").value = "";
        document.getElementById("filter-name").value = "";
        filterAttendance();
      }

      function filterAttendance() {
        const filterDate = document.getElementById("filter-date").value;
        const filterName = document.getElementById("filter-name").value;
        const container = document.getElementById("attendance-records");
        const filterInfo = document.getElementById("filter-info");

        let filtered = [...attendanceList];
        let filterDescriptions = [];

        // Filter by name
        if (filterName) {
          filtered = filtered.filter((a) => a.name === filterName);
          filterDescriptions.push(filterName);
        }

        // Filter by date
        if (filterDate) {
          filtered = filtered.filter((a) => {
            // Extract date from ISO timestamp or use date field directly
            let recordDate = a.date;

            // If date is ISO timestamp, extract YYYY-MM-DD part
            if (recordDate && recordDate.includes("T")) {
              recordDate = recordDate.split("T")[0];
            }

            return recordDate === filterDate;
          });
          filterDescriptions.push(formatDate(filterDate));
        }

        // Update filter info text
        if (filterDescriptions.length > 0) {
          filterInfo.textContent = "Menampilkan " + filtered.length + " dari " + attendanceList.length + " total absensi untuk " + filterDescriptions.join(" ÔøΩÔøΩ ");
        } else {
          filterInfo.textContent = "Menampilkan semua " + attendanceList.length + " data absensi";
        }

        document.getElementById("attendance-count").textContent = filtered.length;

        if (filtered.length === 0) {
          if (filterDate || filterName) {
            showEmptyFilteredAttendance();
          } else {
            showEmptyAttendance();
          }
          return;
        }

        // Sort by timestamp (newest first)
        filtered.sort((a, b) => {
          const timeA = a.timestamp || a.createdAt || new Date(a.date + " " + a.time).toISOString();
          const timeB = b.timestamp || b.createdAt || new Date(b.date + " " + b.time).toISOString();
          return new Date(timeB) - new Date(timeA);
        });

        const recordsHTML = filtered
          .map((record) => {
            const statusColors = {
              masuk: "bg-gradient-to-r from-slate-600 to-slate-700 text-white",
              pulang: "bg-gradient-to-r from-amber-500 to-orange-600 text-white",
              dinas: "bg-gradient-to-r from-purple-500 to-purple-600 text-white",
            };

            const statusLabels = {
              masuk: "Masuk",
              pulang: "Pulang",
              dinas: "Dinas",
            };

            const safeName = String(record.name || "Tidak diketahui")
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#39;");
            const safeId = String(record.id || "")
              .replace(/&/g, "&amp;")
              .replace(/</g, "&lt;")
              .replace(/>/g, "&gt;")
              .replace(/"/g, "&quot;")
              .replace(/'/g, "&#39;");

            // Format date and time properly from timestamp
            let formattedDate, displayTime;

            if (record.timestamp) {
              // Extract from ISO timestamp
              const timestamp = new Date(record.timestamp);
              formattedDate = timestamp.toLocaleDateString("id-ID", { weekday: "short", day: "numeric", month: "short", year: "numeric" });
              displayTime = timestamp.toLocaleTimeString("id-ID", { hour: "2-digit", minute: "2-digit", second: "2-digit" });
            } else {
              // Fallback to date and time fields
              formattedDate = formatDate(record.date);
              displayTime = record.time || "00:00:00";
            }

            const photoSrc = record.photo || "";
            const address = record.address || "Lokasi tidak tersedia";
            const statusClass = statusColors[record.status] || "bg-slate-500";
            const statusLabel = statusLabels[record.status] || record.status;

            return (
              '<div class="bg-gradient-to-r from-slate-50 to-slate-100 rounded-2xl p-5 hover:shadow-md transition border-2 border-slate-200"><div class="flex flex-col items-center text-center sm:flex-row sm:items-start sm:text-left gap-4"><img src="' +
              photoSrc +
              '" alt="Foto" class="w-24 h-24 sm:w-24 sm:h-24 object-cover rounded-xl flex-shrink-0 shadow-md border-2 border-white" loading="lazy" onerror="this.style.background=\'#e5e7eb\'; this.alt=\'Foto gagal dimuat\';"><div class="flex-1 min-w-0 w-full"><div class="flex flex-col items-center sm:flex-row sm:items-start sm:justify-between gap-3 mb-3"><p class="font-bold text-slate-800 text-base sm:text-lg leading-snug break-words">' +
              (record.name || "Tidak diketahui") +
              '</p><span class="px-3 py-1.5 sm:px-3 sm:py-2 rounded-xl text-xs sm:text-sm font-black ' +
              statusClass +
              ' shadow-md whitespace-nowrap flex-shrink-0">' +
              statusLabel +
              '</span></div><div class="space-y-1.5 mb-3"><p class="text-sm sm:text-base text-slate-600 font-semibold">üìÖ ' +
              formattedDate +
              '</p><p class="text-sm sm:text-base text-slate-600 font-semibold">üïê ' +
              displayTime +
              '</p></div><p class="text-xs sm:text-sm text-slate-500 line-clamp-2 leading-relaxed mb-3" title="' +
              address +
              '">' +
              address +
              "</p><button onclick=\"showDeleteModal('attendance', '" +
              safeId +
              "', '" +
              safeName +
              '\')" class="text-red-500 hover:text-white hover:bg-red-500 px-4 py-2 rounded-xl transition shadow-sm font-bold text-sm flex items-center gap-2 mt-2 mx-auto sm:mx-0" title="Hapus absensi"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>Hapus</button></div></div></div>'
            );
          })
          .join("");

        container.innerHTML = recordsHTML;
      }

      // Add Staff
      async function addStaff(e) {
        e.preventDefault();

        if (isAddingStaff) return;

        const nameInput = document.getElementById("new-staff-name");
        const name = nameInput.value.trim();

        if (!name) {
          showToast("Nama tidak boleh kosong", "error");
          return;
        }

        // Check duplicate
        if (staffList.some((s) => s.name.toLowerCase() === name.toLowerCase())) {
          showToast("Nama guru/staff sudah ada", "error");
          return;
        }

        const url = getAppsScriptUrl();
        if (!url) {
          showToast("URL Apps Script belum dikonfigurasi", "error");
          return;
        }

        isAddingStaff = true;
        const addBtn = document.getElementById("add-staff-btn");
        addBtn.innerHTML = '<div class="w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin"></div> Menambahkan...';
        addBtn.disabled = true;

        try {
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify({
              action: "addStaff",
              name: name,
            }),
          });

          const result = await response.json();

          if (result.success) {
            showToast("Guru/Staff berhasil ditambahkan!", "success");
            nameInput.value = "";
            await loadAllData();
          } else {
            showToast(result.message || "Gagal menambahkan guru/staff", "error");
          }
        } catch (error) {
          showToast("Error menambahkan staff: " + error.message, "error");
        } finally {
          isAddingStaff = false;
          addBtn.innerHTML = '<svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg> Tambah Guru/Staff';
          addBtn.disabled = false;
        }
      }

      // Edit Staff Functions
      let editTarget = null;

      function showEditModal(id, name) {
        editTarget = id;
        // Decode HTML entities back to normal text
        const textarea = document.createElement("textarea");
        textarea.innerHTML = name;
        const decodedName = textarea.value;

        document.getElementById("edit-staff-name").value = decodedName;
        document.getElementById("edit-modal").classList.remove("hidden");
      }

      function closeEditModal() {
        editTarget = null;
        document.getElementById("edit-staff-name").value = "";
        document.getElementById("edit-modal").classList.add("hidden");
      }

      async function saveEditStaff(e) {
        e.preventDefault();

        if (!editTarget) return;

        const newName = document.getElementById("edit-staff-name").value.trim();

        if (!newName) {
          showToast("Nama tidak boleh kosong", "error");
          return;
        }

        // Check duplicate (exclude current staff)
        const existingStaff = staffList.find((s) => s.id !== editTarget && s.name.toLowerCase() === newName.toLowerCase());
        if (existingStaff) {
          showToast("Nama guru/staff sudah ada", "error");
          return;
        }

        const url = getAppsScriptUrl();
        if (!url) {
          showToast("URL Apps Script belum dikonfigurasi", "error");
          return;
        }

        const saveBtn = document.getElementById("save-edit-btn");
        saveBtn.innerHTML = '<div class="w-6 h-6 border-3 border-white border-t-transparent rounded-full animate-spin"></div>';
        saveBtn.disabled = true;

        try {
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify({
              action: "editStaff",
              id: editTarget,
              name: newName,
            }),
          });

          const result = await response.json();

          if (result.success) {
            showToast("Nama berhasil diubah!", "success");
            closeEditModal();
            await loadAllData();
          } else {
            showToast(result.message || "Gagal mengubah nama", "error");
          }
        } catch (error) {
          showToast("Error mengubah staff: " + error.message, "error");
        } finally {
          saveBtn.innerHTML = "Simpan";
          saveBtn.disabled = false;
        }
      }

      // Delete Functions
      function showDeleteModal(type, id, name) {
        // Decode HTML entities back to normal text
        const textarea = document.createElement("textarea");
        textarea.innerHTML = name;
        const decodedName = textarea.value;

        deleteTarget = { type: type, id: id, name: decodedName };
        document.getElementById("delete-modal-text").textContent = 'Apakah Anda yakin ingin menghapus "' + decodedName + '"?';
        document.getElementById("delete-modal").classList.remove("hidden");
      }

      function closeDeleteModal() {
        deleteTarget = null;
        document.getElementById("delete-modal").classList.add("hidden");
      }

      async function confirmDelete() {
        if (!deleteTarget) return;

        const url = getAppsScriptUrl();
        if (!url) {
          showToast("URL Apps Script belum dikonfigurasi", "error");
          closeDeleteModal();
          return;
        }

        const btn = document.getElementById("confirm-delete-btn");
        btn.innerHTML = '<div class="w-6 h-6 border-4 border-white border-t-transparent rounded-full animate-spin mx-auto"></div>';
        btn.disabled = true;

        try {
          const response = await fetch(url, {
            method: "POST",
            body: JSON.stringify({
              action: deleteTarget.type === "staff" ? "deleteStaff" : "deleteAttendance",
              id: deleteTarget.id,
            }),
          });

          const result = await response.json();

          if (result.success) {
            // Close modal first
            btn.innerHTML = "Hapus";
            btn.disabled = false;
            closeDeleteModal();

            // Show success message
            showToast("Data berhasil dihapus!", "success");

            // Reload data WITHOUT showing loading overlay
            const savedIsLoading = isLoading;
            isLoading = true; // Prevent loadAllData from showing overlay

            const response2 = await fetch(url + "?action=getAll");
            const data = await response2.json();

            if (data.success) {
              staffList = data.staff || [];
              attendanceList = data.attendance || [];

              updateStaffSelect();
              updateStaffList();
              updateAttendanceRecords();
            }

            isLoading = savedIsLoading;
          } else {
            showToast(result.message || "Gagal menghapus data", "error");
            btn.innerHTML = "Hapus";
            btn.disabled = false;
          }
        } catch (error) {
          showToast("Error menghapus data: " + error.message, "error");
          btn.innerHTML = "Hapus";
          btn.disabled = false;
          closeDeleteModal();
        }
      }

      // Password Protection
      const ADMIN_PASSWORD = "EBUVyML5h!g5Uek";
      const ADMIN_AUTH_KEY = "admin_authenticated";

      // Toggle Password Visibility
      function togglePasswordVisibility() {
        const passwordInput = document.getElementById("admin-password-input");
        const eyeOpen = document.getElementById("password-eye-open");
        const eyeClosed = document.getElementById("password-eye-closed");

        if (passwordInput.type === "password") {
          passwordInput.type = "text";
          eyeOpen.classList.remove("hidden");
          eyeClosed.classList.add("hidden");
        } else {
          passwordInput.type = "password";
          eyeOpen.classList.add("hidden");
          eyeClosed.classList.remove("hidden");
        }
      }

      // Check if already logged in
      function isAdminAuthenticated() {
        return localStorage.getItem(ADMIN_AUTH_KEY) === "true";
      }

      // Set admin authenticated
      function setAdminAuthenticated() {
        localStorage.setItem(ADMIN_AUTH_KEY, "true");
      }

      // Clear admin authentication (optional logout)
      function clearAdminAuthentication() {
        localStorage.removeItem(ADMIN_AUTH_KEY);
      }

      function promptAdminPassword() {
        // Check if already authenticated
        if (isAdminAuthenticated()) {
          showPage("admin");
          showToast("Selamat datang kembali di Admin Panel", "success");
          return;
        }

        document.getElementById("password-modal").classList.remove("hidden");
        document.getElementById("admin-password-input").value = "";
        document.getElementById("password-error").classList.add("hidden");

        // Focus on password input
        setTimeout(() => {
          document.getElementById("admin-password-input").focus();
        }, 100);
      }

      function closePasswordModal() {
        document.getElementById("password-modal").classList.add("hidden");
        document.getElementById("admin-password-input").value = "";
        document.getElementById("password-error").classList.add("hidden");
      }

      function checkAdminPassword(e) {
        e.preventDefault();

        const inputPassword = document.getElementById("admin-password-input").value;
        const errorMsg = document.getElementById("password-error");

        if (inputPassword === ADMIN_PASSWORD) {
          setAdminAuthenticated();
          closePasswordModal();
          showPage("admin");
          showToast("Berhasil masuk ke Admin Panel", "success");
        } else {
          errorMsg.classList.remove("hidden");
          document.getElementById("admin-password-input").value = "";
          document.getElementById("admin-password-input").focus();

          // Shake animation
          const modal = document.querySelector("#password-modal > div");
          modal.style.animation = "none";
          setTimeout(() => {
            modal.style.animation = "shake 0.5s";
          }, 10);
        }
      }

      // Helper Functions
      function formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString("id-ID", { weekday: "short", day: "numeric", month: "short", year: "numeric" });
      }

      // Initialize
      initApp();
    </script>
    <script>
      (function () {
        function c() {
          var b = a.contentDocument || a.contentWindow.document;
          if (b) {
            var d = b.createElement("script");
            d.innerHTML =
              "window.__CF$cv$params={r:'9c73909e5002d439',t:'MTc2OTk3MTA5OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";
            b.getElementsByTagName("head")[0].appendChild(d);
          }
        }
        if (document.body) {
          var a = document.createElement("iframe");
          a.height = 1;
          a.width = 1;
          a.style.position = "absolute";
          a.style.top = 0;
          a.style.left = 0;
          a.style.border = "none";
          a.style.visibility = "hidden";
          document.body.appendChild(a);
          if ("loading" !== document.readyState) c();
          else if (window.addEventListener) document.addEventListener("DOMContentLoaded", c);
          else {
            var e = document.onreadystatechange || function () {};
            document.onreadystatechange = function (b) {
              e(b);
              "loading" !== document.readyState && ((document.onreadystatechange = e), c());
            };
          }
        }
      })();
    </script>
  </body>
</html>
